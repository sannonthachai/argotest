var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,i=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&s(e,a,t[a]);return e},n=(e,l)=>t(e,a(l));import{h as u,a as d,m as c,i as p,e as m,c as v}from"./index.d7dc1ff6.js";import{_ as f}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{i as y}from"./avatar.helper.68db04c2.js";import{t as b}from"./date.helper.6ae3fc87.js";import{p as g,a as h,d as N,k as V,E as _,o as x,y as S,F as j,h as k,t as I,g as w,G as O,i as E,x as C,e as D,q as M,D as A,A as B,Y as H,ae as P,r as R,S as U,K as Y,V as L,ao as T,ap as q,ai as F,b as W,O as K,H as z,I as G}from"./vendor.1c8b4573.js";import{_ as $}from"./VModal.31b4f4ba.js";import{u as J}from"./useGuardStudent.237f12b5.js";import{u as Q}from"./useLogApi.90f2b872.js";import{u as X}from"./useNotyf.ddf08f06.js";import{u as Z}from"./usePaginationRoute.780ca235.js";import{f as ee}from"./student.enum.ad6af513.js";import{_ as te,a as ae}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{u as le}from"./useOptionApi.f4dc99b9.js";import"./index.ec15dc7d.js";import"./lodash.0a1ccad5.js";import"./quiz.enum.fc8b95fc.js";const oe=e=>{const t=(null==e?void 0:e.replace("followup","Follow up ").replace("week","week ").trim())||"-";return t[0].toUpperCase()+t.substring(1)};g("data-v-5ceb3438");const re={class:"card-head"},se={class:"is-flex is-align-items-center"},ie={class:"title is-5 mr-2 mb-0"},ne={class:"is-flex is-align-items-center"},ue=k("i",{class:"iconify mr-2","data-icon":"feather:clock"},null,-1),de=[k("div",{class:"icon"},[k("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:file-text"})],-1),k("div",{class:"meta"},[k("span",null,"Edit"),k("span",null,"edit this note")],-1)],ce={class:"card-inner content"},pe=["innerHTML"],me={class:"card-foot"},ve={class:"is-flex is-align-items-center"},fe={class:"mx-2"},ye={class:"creator-box"},be={class:"is-flex is-align-items-center"},ge=k("p",null,"Created by",-1),he={class:"mx-2"},Ne={class:"is-flex is-align-items-center"},Ve=k("i",{class:"iconify mr-2","data-icon":"feather:clock"},null,-1),_e={key:0,class:"creator-box"},xe={class:"is-flex is-align-items-center"},Se=k("p",null,"Updated at",-1),je={class:"mx-2"},ke={class:"is-flex is-align-items-center"},Ie=k("i",{class:"iconify mr-2","data-icon":"feather:clock"},null,-1);h();var we=N({props:{reportNote:{type:Object,required:!0},canEdit:{type:Boolean,default:!1}},emits:["select"],setup(e,{emit:t}){const a=e,l=V((()=>{var e;return null==(e=a.reportNote.detail)?void 0:e.replaceAll("\n","<br />")})),o=e=>{const t=e||"Anonymus",[a,l]=t.split(" ").filter((e=>!!e));return y(a,l)},r=V((()=>{var e,t;return o(null==(t=null==(e=a.reportNote)?void 0:e.createdBy)?void 0:t.fullname)})),s=V((()=>{var e,t;return o(null==(t=null==(e=a.reportNote)?void 0:e.updatedBy)?void 0:t.fullname)})),i=V((()=>a.reportNote.updatedBy?s.value:r.value)),n=V((()=>{var e;return a.reportNote.updatedBy?a.reportNote.updatedBy.name:(null==(e=a.reportNote.createdBy)?void 0:e.name)||"Anonymus"})),c=e=>b(e,"DD/MM/YYYY HH:mm"),p=V((()=>b(a.reportNote.time,"DD/MM/YYYY HH:mm")));return(o,r)=>{const s=u,m=d,v=_("tippy"),y=f;return x(),S(y,{class:"report-note-card"},{default:j((()=>[k("div",re,[k("div",null,[k("span",se,[k("h4",ie," Topic: "+I(w(oe)(a.reportNote.topic)),1),k("p",ne,[ue,O(" "+I(w(p)),1)])])]),e.canEdit?(x(),S(s,{key:0,icon:"feather:more-vertical",spaced:"",right:""},{content:j((()=>[k("a",{role:"menuitem",class:"dropdown-item is-media",onClick:r[0]||(r[0]=e=>t("select"))},de)])),_:1})):E("",!0)]),k("div",ce,[k("p",{innerHTML:w(l)},null,8,pe)]),k("div",me,[C(v,{class:"has-help-cursor",interactive:"",placement:"top"},{content:j((()=>{var e,t;return[k("div",ye,[k("div",be,[ge,k("strong",he,I((null==(e=a.reportNote.createdBy)?void 0:e.name)||"Anonymus"),1)]),k("p",Ne,[Ve,O(" "+I(c(a.reportNote.createdAt)),1)])]),a.reportNote.updatedBy&&a.reportNote.updatedAt?(x(),D("div",_e,[k("div",xe,[Se,k("strong",je,I((null==(t=a.reportNote.updatedBy)?void 0:t.name)||"Anonymus"),1)]),k("p",ke,[Ie,O(" "+I(c(a.reportNote.updatedAt)),1)])])):E("",!0)]})),default:j((()=>[k("div",ve,[C(m,{initials:w(i).initials,color:w(i).color,size:"small"},null,8,["initials","color"]),k("p",fe,I(w(n)),1)])])),_:1})])])),_:1})}}});function Oe(){const e=M({reportNotes:[],currentNote:{topic:ee.OTHER,detail:"",time:A().format(),studentId:0},validation:void 0,isSubmitting:!1,hideLoadMore:!1}),t=B(),{createReportNoteByStudentId:a,updateReportNoteByStudentId:l,getAllReportNoteByStudentId:o}=Q(),{handleResNotyf:r}=function(){M({});const e=X();return{handleResNotyf:(t,a)=>{const l=c(t),o=p(t),{message:r}=t;return l?e.success((null==a?void 0:a.msgSuccess)||"Success!"):(void 0===(null==a?void 0:a.showError)||(null==a?void 0:a.showError))&&e.error(m(r)||(null==a?void 0:a.msgError)||"Something went wrong, please try again"),{isSuccess:l,data:o,message:r,validation:"object"==typeof r?r:void 0}}}}(),{currentPage:s,perPage:u,search:d}=Z(),v=V((()=>t.params.id)),f=()=>{e.currentNote={topic:ee.OTHER,detail:"",time:A().format(),studentId:parseInt(v.value)}},y=async()=>{const t=await o({currentPage:s,perPage:u,search:d,studentId:parseInt(v.value)});(null==t?void 0:t.data)&&(e.reportNotes=t.data,e.hideLoadMore=!t.nextPage)},b=t=>{const{isSuccess:a,validation:l}=r(t,{showError:!1});return a?(y(),f(),e.validation=void 0):e.validation=l,a};return H((()=>{y()})),n(i({},P(e)),{create:async()=>{e.isSubmitting=!0;const t=await a(n(i({},e.currentNote),{studentId:parseInt(v.value)}));return e.isSubmitting=!1,b(t)},update:async t=>{e.isSubmitting=!0;const a=await l(n(i({},e.currentNote),{studentId:parseInt(v.value)}));e.isSubmitting=!1,b(a)},fetchAllReportNote:y,setDefaultNote:f})}we.__scopeId="data-v-5ceb3438";const Ee={class:"form-body"},Ce={class:"modal-form"},De=k("label",null,"Topic",-1),Me={class:"v-fade help text-danger"},Ae=k("label",null,"Date",-1),Be=["value"],He=k("label",null,"Detail",-1);var Pe=N({props:{modelValue:{type:Object,default:void 0}},emits:["update-can-submit","submit","update:modelValue"],setup(e,{expose:t,emit:a}){var l,o,r,s;const u=e,{getStudentNoteLogTopic:d}=le(),c=R({topic:(null==(l=u.modelValue)?void 0:l.topic)||ee.OTHER,time:A(null==(o=u.modelValue)?void 0:o.time).format(),detail:(null==(r=u.modelValue)?void 0:r.detail)||"",studentId:(null==(s=u.modelValue)?void 0:s.studentId)||0}),p=R([]),m=V((()=>!!c.value.topic&&!!c.value.time&&!!c.value.detail)),v=()=>{a("update:modelValue",n(i(i({},u.modelValue),c.value),{time:A(c.value.time).toISOString()})),a("update-can-submit",m.value)};return U((()=>m.value),(()=>a("update-can-submit",m.value))),H((async()=>{p.value=await d();const e=[ee.FOLLOW_UP_WEEK_1,ee.FOLLOW_UP_WEEK_2];e.some((e=>{var t;return e===(null==(t=u.modelValue)?void 0:t.topic)}))?p.value=p.value.map((t=>e.includes(t.value)?n(i({},t),{disabled:!0}):t)):p.value=p.value.filter((t=>!e.includes(t.value)))})),t({clearDefault:()=>{var e,t,a,l;c.value={topic:(null==(e=u.modelValue)?void 0:e.topic)||ee.OTHER,time:A(null==(t=u.modelValue)?void 0:t.time).format(),detail:(null==(a=u.modelValue)?void 0:a.detail)||"",studentId:(null==(l=u.modelValue)?void 0:l.studentId)||0}}}),(e,t)=>{const a=_("Multiselect"),l=te,o=ae,r=_("v-date-picker");return x(),D("div",Ee,[k("form",Ce,[C(o,null,{default:j((()=>[De,C(l,null,{default:j((()=>[C(a,{modelValue:c.value.topic,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value.topic=e),options:p.value,placeholder:"Select topic",label:"key","can-clear":!1,onSelect:v},null,8,["modelValue","options"]),Y(k("label",Me," Topic is required. ",512),[[L,!c.value.topic]])])),_:1})])),_:1}),C(r,{modelValue:c.value.time,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value.time=e),"model-config":{type:"date",mask:"iso"},masks:{inputDateTime24hr:"DD/MM/YYYY HH:mm"},mode:"dateTime",is24hr:"",color:"orange","trim-weeks":"",onClick:v},{default:j((({inputValue:e,inputEvents:t})=>[C(o,null,{default:j((()=>[Ae,C(l,{icon:"feather:calendar"},{default:j((()=>[k("input",T({class:"input",type:"text",value:e},q(t)),null,16,Be)])),_:2},1024)])),_:2},1024)])),_:1},8,["modelValue"]),C(o,null,{default:j((()=>[He,C(l,null,{default:j((()=>[Y(k("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>c.value.detail=e),type:"textarea",class:"textarea is-primary-focus",rows:"7",placeholder:"Detail",onInput:v},null,544),[[F,c.value.detail]])])),_:1})])),_:1})])])}}});g("data-v-4a60cace");const Re={class:"page-content-inner"},Ue={key:0,class:"account-box is-form is-footerless mb-3"},Ye={class:"form-head stuck-header"},Le={class:"form-head-inner"},Te=k("div",{class:"left"},[k("h3",null,"Report Note"),k("p",null,"Create student's report note")],-1),qe={class:"right"},Fe={class:"has-text-right"},We=O(" Save "),Ke={class:"load-more-wrap has-text-centered py-4"},ze=O(" Load More "),Ge=O("Update");h();var $e=N({setup(e){const{note:t}=J(),a=W(),l=B(),o=R(!1),r=R(),s=()=>{var e;a.push({name:l.name||void 0,query:{page:(parseInt(`${null==(e=l.query)?void 0:e.page}`)||1)+1}})},{currentNote:i,create:n,update:u,reportNotes:d,validation:c,setDefaultNote:p,isSubmitting:m,hideLoadMore:f}=Oe(),y=async()=>{var e;await n()&&(null==(e=r.value)||e.clearDefault())};return(e,a)=>{var l,n;const c=v,b=we,g=v,h=$;return x(),D("div",Re,[w(t).canCreate?(x(),D("div",Ue,[k("div",Ye,[k("div",Le,[Te,k("div",qe,[k("div",Fe,[C(c,{color:"primary",disabled:!o.value,loading:w(m),raised:"",onClick:y},{default:j((()=>[We])),_:1},8,["disabled","loading"])])])])]),C(Pe,{ref:(e,t)=>{t.formCreateNoteRef=e,r.value=e},modelValue:w(i),"onUpdate:modelValue":a[0]||(a[0]=e=>K(i)?i.value=e:null),onUpdateCanSubmit:a[1]||(a[1]=e=>o.value=e)},null,8,["modelValue"])])):E("",!0),k("div",null,[(x(!0),D(z,null,G(w(d),(e=>(x(),S(b,{key:`rn-${e.id}`,"report-note":e,"can-edit":w(t).canEdit,onSelect:t=>i.value=e},null,8,["report-note","can-edit","onSelect"])))),128)),k("div",Ke,[w(f)?E("",!0):(x(),S(g,{key:0,onClick:s},{default:j((()=>[ze])),_:1}))])]),(null==(l=w(i))?void 0:l.id)?(x(),S(h,{key:1,open:!!(null==(n=w(i))?void 0:n.id),title:"Update note",actions:"right",onClose:w(p)},{content:j((()=>[C(Pe,{modelValue:w(i),"onUpdate:modelValue":a[2]||(a[2]=e=>K(i)?i.value=e:null),class:"mb-3 report-popup",onUpdateCanSubmit:a[3]||(a[3]=e=>o.value=e)},null,8,["modelValue"])])),action:j((()=>[C(c,{color:"primary",disabled:!o.value,loading:w(m),onClick:w(u)},{default:j((()=>[Ge])),_:1},8,["disabled","loading","onClick"])])),_:1},8,["open","onClose"])):E("",!0)])}}});$e.__scopeId="data-v-4a60cace";export default $e;
