var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,u=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;import{c as r}from"./index.d7dc1ff6.js";import{_ as o}from"./DropdownAction.vue_vue&type=script&setup=true&lang.ced09d37.js";import{_ as i}from"./Datatable.aae3ef08.js";import{a as c,_ as d}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as f}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{_ as p}from"./VModal.31b4f4ba.js";import{u as m}from"./useGuardPartner.354c9ce1.js";import{T as b}from"./partner.enum.43f93474.js";import{p as v,a as y,d as _,r as g,E as h,o as T,y as C,F as P,h as R,x as V,G as I,t as S,g as k,i as w,q as j,A as L,Y as F,ae as G}from"./vendor.1c8b4573.js";import{u as E}from"./usePartnerApi.2e3c406b.js";import{u as x}from"./useNotyf.ddf08f06.js";import{u as B}from"./usePaginationRoute.780ca235.js";import"./VPlaceholderSection.vue_vue&type=script&setup=true&lang.35b0ad2a.js";import"./VLoader.vue_vue&type=script&setup=true&lang.a96d7daf.js";import"./VFlexPagination.86ce707c.js";import"./search-4-dark.fb3880a5.js";v("data-v-bfd65f6c");const O={class:"form-box"},U=R("label",{class:"label"},"Student Info",-1),A=R("label",{class:"label"},"Test Result Level",-1),D=R("label",{class:"label"},"Listening",-1),q=R("label",{class:"label"},"Speaking",-1),$=R("label",{class:"label"},"Vocabulary",-1),H=R("label",{class:"label"},"Grammar",-1),M=R("label",{class:"label"},"Fluency",-1),N=R("label",{class:"label"},"Level",-1),z=I(" Create "),Y=I(" Update ");y();var J=_({props:{open:{type:Boolean,default:!1},studentInfo:{type:Object,required:!0},testResult:{type:Object,required:!0}},emits:["close","create","update"],setup(e,{emit:t}){const a=e,{consults:l}=m(),s=g({id:a.testResult.id,type:a.testResult.type,cefrLevel:a.testResult.cefrLevel,cefrListening:a.testResult.cefrListening,cefrSpeaking:a.testResult.cefrSpeaking,cefrVocabulary:a.testResult.cefrVocabulary,cefrGrammar:a.testResult.cefrGrammar,cefrFluency:a.testResult.cefrFluency,version:a.testResult.version}),n=[{label:"Pre Globish",value:0},{label:"G1",value:1},{label:"G2",value:2},{label:"G3",value:3},{label:"G4",value:4},{label:"G5",value:5},{label:"G6",value:6},{label:"G7",value:7},{label:"G8",value:8}],u=s.value.id||s.value.type!==b.PRE_TEST?l.value.canCreateConsultPosttest:l.value.canCreateConsultPretest,o=s.value.id&&s.value.type===b.PRE_TEST?l.value.canEditConsultPretest:l.value.canEditConsultPosttest,i=()=>{t("close")},v=()=>{t("create",s.value)},y=()=>{t("update",s.value)};return(t,a)=>{const l=c,m=f,b=h("Multiselect"),_=d,g=r,j=p;return T(),C(j,{open:e.open,title:"Test Result",size:"large",onClose:i},{content:P((()=>[R("div",O,[V(l,null,{default:P((()=>[U,V(m,null,{default:P((()=>[V(l,null,{default:P((()=>[I(" Student: ("+S(e.studentInfo.id)+") "+S(e.studentInfo.firstname.en?e.studentInfo.firstname.en:e.studentInfo.firstname.th)+" "+S(e.studentInfo.lastname.en?e.studentInfo.lastname.en:e.studentInfo.lastname.th),1)])),_:1}),V(l,null,{default:P((()=>[I(" Type: "+S(s.value.type),1)])),_:1}),V(l,null,{default:P((()=>[I(" Version: "+S(s.value.version),1)])),_:1})])),_:1})])),_:1}),V(l,{class:"mt-6"},{default:P((()=>[A,V(m,null,{default:P((()=>[V(l,{class:"mb-5"},{default:P((()=>[D,V(_,null,{default:P((()=>[V(b,{modelValue:s.value.cefrListening,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.cefrListening=e),options:n,label:"label"},null,8,["modelValue"])])),_:1})])),_:1}),V(l,{class:"mb-5"},{default:P((()=>[q,V(_,null,{default:P((()=>[V(b,{modelValue:s.value.cefrSpeaking,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.cefrSpeaking=e),options:n,label:"label"},null,8,["modelValue"])])),_:1})])),_:1}),V(l,{class:"mb-5"},{default:P((()=>[$,V(_,null,{default:P((()=>[V(b,{modelValue:s.value.cefrVocabulary,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.cefrVocabulary=e),options:n,label:"label"},null,8,["modelValue"])])),_:1})])),_:1}),V(l,{class:"mb-5"},{default:P((()=>[H,V(_,null,{default:P((()=>[V(b,{modelValue:s.value.cefrGrammar,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.cefrGrammar=e),options:n,label:"label"},null,8,["modelValue"])])),_:1})])),_:1}),V(l,{class:"mb-5"},{default:P((()=>[M,V(_,null,{default:P((()=>[V(b,{modelValue:s.value.cefrFluency,"onUpdate:modelValue":a[4]||(a[4]=e=>s.value.cefrFluency=e),options:n,label:"label"},null,8,["modelValue"])])),_:1})])),_:1}),V(l,{class:"mb-5"},{default:P((()=>[N,V(_,null,{default:P((()=>[V(b,{modelValue:s.value.cefrLevel,"onUpdate:modelValue":a[5]||(a[5]=e=>s.value.cefrLevel=e),options:n,label:"label"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])])),action:P((()=>[!s.value.id&&k(u)?(T(),C(g,{key:0,color:"primary",onClick:v},{default:P((()=>[z])),_:1})):w("",!0),s.value.id&&k(o)?(T(),C(g,{key:1,color:"primary",onClick:y},{default:P((()=>[Y])),_:1})):w("",!0)])),_:1},8,["open"])}}});function K(){const e=j({studentList:[],isLoading:!1,total:0,currentBatchStudent:void 0,isShowConsultForm:!1,currentTestResult:void 0}),r=L().params.id,o=x(),{currentPage:i,perPage:c,search:d}=B(),{getBatchStudents:f,getTestResult:p,createTestResult:m,updateTestResult:b}=E(),v=t=>{e.currentBatchStudent=t,t||(e.currentTestResult=void 0)};return F((async()=>{await(async()=>{e.isLoading=!0;const t=await f({batchId:+r,currentPage:i,perPage:c,search:d});t&&(e.studentList=t.data,e.total=t.total),e.isLoading=!1})()})),y=((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&u(e,a,t[a]);if(l)for(var a of l(t))n.call(t,a)&&u(e,a,t[a]);return e})({},G(e)),t(y,a({consultTableHeaders:[{key:"studentInfo.id",label:"ID"},{key:"studentInfo",label:"Name",isRaw:!0},{key:"studentInfo.phone",label:"Phone"},{key:"pretestButtons",label:"Pre-Test",isRaw:!0,isCenter:!0},{key:"posttestButtons",label:"Post-Test",isRaw:!0,isCenter:!0},{key:"action",label:"Action",isRaw:!0,isCenter:!0}],openConsultForm:async(t,a)=>{t&&(v(t),await(async(t,a)=>{const l=await p(t,a);l.error?e.currentTestResult={id:0,type:a,cefrLevel:0,cefrListening:0,cefrSpeaking:0,cefrVocabulary:0,cefrGrammar:0,cefrFluency:0,version:3}:e.currentTestResult=l.data})(t.studentInfo.id,a),e.isShowConsultForm=!0)},closeConsultForm:()=>{v(),e.isShowConsultForm=!1},submitCreateTestResult:async t=>{if(!e.currentBatchStudent)return;const a=await m(e.currentBatchStudent.studentInfo.id,t);if(!a.error)return e.currentTestResult=void 0,e.isShowConsultForm=!1,void o.success("Create test result success");o.error(a.message)},submitUpdateTestResult:async t=>{if(!t.id||!e.currentBatchStudent)return;const a=await b(e.currentBatchStudent.studentInfo.id,t);if(!a.error)return e.currentTestResult=void 0,e.isShowConsultForm=!1,void o.success("Update test result successfully");o.error(a.message)}}));var y}J.__scopeId="data-v-bfd65f6c",v("data-v-95b7aa2e");const Q=R("h3",{class:"title is-5 mb-2"},"Pretest & Posttest",-1),W={class:"is-flex"},X=["href"],Z={class:"consult-buttons is-flex"},ee=I("Pretest"),te={class:"consult-buttons is-flex"},ae=I("Posttest"),le={class:"dark-inverted is-flex is-justify-content-flex-end"},se=["href"],ne=[R("div",{class:"icon"},[R("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download"})],-1),R("div",{class:"meta"},[R("span",null,"Export Pre-Test"),R("span",null,"Export Pre-Test")],-1)],ue=["href"],re=[R("div",{class:"icon"},[R("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:download"})],-1),R("div",{class:"meta"},[R("span",null,"Export Post-Test"),R("span",null,"Export Post-Test")],-1)];y();var oe=_({setup(e){const{studentList:t,consultTableHeaders:a,isLoading:l,total:s,isShowConsultForm:n,currentBatchStudent:u,currentTestResult:c,openConsultForm:d,closeConsultForm:p,submitCreateTestResult:m,submitUpdateTestResult:v}=K();return(e,y)=>{const _=r,g=o,h=i,I=J,j=f;return T(),C(j,{class:"consult-page"},{default:P((()=>{var e;return[Q,V(h,{data:k(t),total:k(s),"is-loading":k(l),headers:k(a)},{studentInfo:P((({value:e})=>[R("div",W,[R("a",{href:`/students/${e.studentInfo.id}`,target:"_blank",class:"link"},S(e.studentInfo.fullnameEn||e.studentInfo.fullnameTh),9,X)])])),pretestButtons:P((({value:e})=>[R("div",Z,[V(_,{class:"button is-small is-warning",onClick:t=>{d(e,b.PRE_TEST)}},{default:P((()=>[ee])),_:2},1032,["onClick"])])])),posttestButtons:P((({value:e})=>[R("div",te,[V(_,{class:"button is-small is-warning",onClick:t=>{d(e,b.POST_TEST)}},{default:P((()=>[ae])),_:2},1032,["onClick"])])])),action:P((({value:e})=>[R("div",le,[V(g,null,{content:P((()=>[R("a",{class:"dropdown-item is-media",href:`/partners/certify/${e.studentInfo.id}?type=pretest`,target:"_blank"},ne,8,se),R("a",{class:"dropdown-item is-media",href:`/partners/certify/${e.studentInfo.id}?type=posttest`,target:"_blank"},re,8,ue)])),_:2},1024)])])),_:1},8,["data","total","is-loading","headers"]),(null==(e=k(u))?void 0:e.studentInfo)&&k(c)?(T(),C(I,{key:k(u).studentInfo.id,"student-info":k(u).studentInfo,"test-result":k(c),open:k(n),onClose:k(p),onCreate:k(m),onUpdate:k(v)},null,8,["student-info","test-result","open","onClose","onCreate","onUpdate"])):w("",!0)]})),_:1})}}});oe.__scopeId="data-v-95b7aa2e";export default oe;
