var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))i.call(a,l)&&o(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{o as c,e as d,p as u,c as p,j as m}from"./index.d7dc1ff6.js";import{_ as f}from"./VModal.31b4f4ba.js";import{_ as v}from"./VSwitchBlock.vue_vue&type=script&setup=true&lang.fd20ebd0.js";import{_ as b,a as h}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as y}from"./VTag.vue_vue&type=script&setup=true&lang.b31af8ee.js";import{_ as g}from"./DropdownAction.vue_vue&type=script&setup=true&lang.ced09d37.js";import{_ as C}from"./Datatable.aae3ef08.js";import{_ as S}from"./ModalCancelReport.d37d706c.js";import{_ as k}from"./VPlaceholderSection.vue_vue&type=script&setup=true&lang.35b0ad2a.js";import{q as D,A as Y,b as w,r as V,Y as R,S as _,ae as T,D as j,d as M,X as A,E as x,o as I,e as O,x as B,F as q,h as E,g as H,O as P,ao as L,ap as U,K as $,ai as N,t as F,G as z,y as G,b1 as K,i as W,p as X,a as J}from"./vendor.1c8b4573.js";import{u as Q}from"./usePrivateClassess.d8ab23c7.js";import{u as Z}from"./usePaginationRoute.780ca235.js";import{u as ee}from"./useClassroomApi.cba9f1f2.js";import{t as ae}from"./date.helper.6ae3fc87.js";import{u as le}from"./useNotyf.ddf08f06.js";import{u as te}from"./useGuardClassReport.038d8a9c.js";import{c as se}from"./text.helper.174bd8fa.js";import{C as ie,a as oe}from"./class-report.enum.31771efb.js";import"./VLoader.vue_vue&type=script&setup=true&lang.a96d7daf.js";import"./VFlexPagination.86ce707c.js";import"./search-4-dark.fb3880a5.js";import"./useOptionApi.f4dc99b9.js";import"./quiz.enum.fc8b95fc.js";import"./product.enum.768ca89a.js";import"./index.ec15dc7d.js";import"./lodash.0a1ccad5.js";import"./VRadio.89eaf975.js";function ne(){const e=D({cancelReportList:[],currentClassId:null,confirmVoidModal:!1,viewBySpecificTime:!1,dateSearch:!1,isLoading:!0,isVoiding:!1,total:0,filter:{datetime:void 0,search:"",range:{},lessThanSixHours:!1}}),a=Y(),l=w(),{perPage:t,currentPage:s,search:i}=Z(),{getAllcancelReport:o,voidCancelReport:u,updateAcceptableCancelReport:p}=ee(),m=le(),f=V(!1),v=V(void 0),b=V(void 0),h=V(void 0),y=async()=>{e.isLoading=!0;const l=a.query.startDate,i=a.query.endDate;a.query.datetime?(e.filter.datetime=new Date(a.query.datetime),e.viewBySpecificTime=!0):l&&i&&(e.filter.range={start:new Date(j(l,"YYYY-MM-DD").startOf("day").toISOString()),end:new Date(j(i,"YYYY-MM-DD").endOf("day").toISOString())});const n={currentPage:s,perPage:t,datetime:e.viewBySpecificTime&&e.dateSearch?j(e.filter.datetime).toISOString():void 0,startDate:!e.viewBySpecificTime&&e.dateSearch?j(e.filter.range.start).toISOString():void 0,endDate:!e.viewBySpecificTime&&e.dateSearch?j(e.filter.range.end).toISOString():void 0,search:e.filter.search,lessThanSixHours:e.filter.lessThanSixHours},r=await o(n);e.isLoading=!1,r&&(e.cancelReportList=r.data,e.total=r.total)};R((()=>{(()=>{e.dateSearch="true"===a.query.dateSearch,e.viewBySpecificTime="true"===a.query.viewBySpecificTime;const l=a.query.startDate,t=a.query.endDate;a.query.datetime?(e.filter.datetime=new Date(a.query.datetime),e.viewBySpecificTime=!1):l&&t&&(e.filter.range={start:new Date(j(l,"YYYY-MM-DD").toISOString()),end:new Date(j(t,"YYYY-MM-DD").toISOString())}),e.filter.search=a.query.search,e.filter.lessThanSixHours="true"===a.query.lessThanSixHours})(),y()}));const g=()=>{l.push({name:"classrooms-cancel-reports",params:a.params,query:r(n({},a.query),{viewBySpecificTime:e.viewBySpecificTime?"true":"false",dateSearch:e.dateSearch?"true":"false",datetime:e.viewBySpecificTime&&e.dateSearch?j(e.filter.datetime).toISOString():void 0,startDate:!e.viewBySpecificTime&&e.dateSearch?ae(e.filter.range.start,"YYYY-MM-DD"):void 0,endDate:!e.viewBySpecificTime&&e.dateSearch?ae(e.filter.range.end,"YYYY-MM-DD"):void 0,search:e.filter.search,lessThanSixHours:e.filter.lessThanSixHours?"true":"false"})})},C=()=>{v.value=void 0,f.value=!1,b.value=void 0,h.value=void 0};_((()=>e.filter.search),(()=>{""===e.filter.search&&g()}));return r(n({},T(e)),{cancelReportTableHeaders:[{key:"id",label:"Report Id"},{key:"admin",label:"Report By"},{key:"from",label:"From",isRaw:!0},{key:"classroom",label:"Class Id"},{key:"classTime",label:"Class Time",isRaw:!0},{key:"student",label:"Student",isRaw:!0},{key:"coach",label:"Coach",isRaw:!0},{key:"studentSatisfaction",label:"Satisfaction",isCenter:!0},{key:"cancellationTime",label:"Cancelation Time",isCenter:!0},{key:"ticketReturn",label:"Return Ticket",isCenter:!0},{key:"acceptable",label:"Acceptable",isCenter:!0},{key:"reason",label:"Reason"}],filterChange:g,onVoidReport:async a=>{e.isVoiding=!0;const l=await u(a);c(l,"Void cancel report success!"),e.isVoiding=!1,e.currentClassId=null,e.confirmVoidModal=!1,await y()},openChangeAcceptable:f,acceptableRef:v,handleChangeAcceptable:async()=>{if(!v.value)return m.error("The field is required, please try again.");e.isLoading=!0;const a={classId:h.value,classReportCancelId:b.value,acceptable:v.value},{status:l,message:t}=await p(a);200===l||201===l?m.success("Update successfully."):m.error(d(t)),await y(),C()},closeChangeAcceptable:C,selectAcceptable:(e,a,l)=>{v.value=l,f.value=!0,b.value=e,h.value=a}})}X("data-v-3b56c58c");const re={class:"page-content-inner"},ce={class:"acceptable-multiselect"},de=z("Confirm"),ue={class:"custom-filter"},pe={class:"columns is-multiline"},me={class:"column is-full is-flex is-align-items-flex-start is-justify-content-flex-start"},fe={key:0,class:"column is-4"},ve=E("label",{class:"label-date"},"Datetime ",-1),be=["disabled","value"],he={key:1,class:"column is-5"},ye=E("label",{class:"label-date"},"Date range",-1),ge=["disabled","value"],Ce=["disabled","value"],Se={class:"column is-4 is-flex is-align-items-center is-justify-content-flex-start"},ke={class:"column is-8"},De=E("label",null,"Search",-1),Ye={key:0},we={key:1},Ve={key:1},Re={key:1},_e={class:"dark-inverted is-flex is-justify-content-flex-end"},Te=["onClick"],je=[E("div",{class:"icon"},[E("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:file-text"})],-1),E("div",{class:"meta"},[E("span",null,"View Cancel Class Report"),E("span",null,"view cancel class report")],-1)],Me=["onClick"],Ae=[E("div",{class:"icon"},[E("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:file-text"})],-1),E("div",{class:"meta"},[E("span",null,"Edit Cancel Class Report"),E("span",null,"edit cancel class report")],-1)],xe=["onClick"],Ie=[E("div",{class:"icon"},[E("i",{"aria-hidden":"true",class:"lnil lnil-handshake"})],-1),E("div",{class:"meta"},[E("span",null,"Edit Cancel Class Report Acceptable"),E("span",null,"edit cancel class report acceptable")],-1)],Oe=["onClick"],Be=[E("div",{class:"icon"},[E("i",{"aria-hidden":"true",class:"lnil lnil-trash"})],-1),E("div",{class:"meta"},[E("span",null,"Void Cancel Class Report"),E("span",null,"remove cancel class report")],-1)],qe=z("Confirm"),Ee=z("Cancel");J();var He=M({setup(e){u.value="Cancel Class Reports",A({title:"Whitehouse: Classroom"});const{filterChange:a,cancelReportTableHeaders:l,cancelReportList:t,isLoading:s,total:i,viewBySpecificTime:o,onVoidReport:n,currentClassId:r,confirmVoidModal:c,filter:d,dateSearch:D,openChangeAcceptable:Y,acceptableRef:w,selectAcceptable:R,handleChangeAcceptable:_,closeChangeAcceptable:T}=ne(),{classIdCancelReport:j,privateCancelReport:M,fetchCancelReportByClassId:X,onSavedReport:J}=Q(),{capabilities:Z,haveActionCancelButton:ee}=te(),le=e=>K(e),He=V(!1);V(!1);const Pe=V(!1),Le=()=>{r.value=null,c.value=!1},Ue=async(e,a)=>{j.value=e,await X(),Pe.value=a,He.value=!0},$e=[ie.ACCEPTABLE,ie.UNACCEPTABLE,ie.INTERNET];return(e,u)=>{const V=x("Multiselect"),A=p,K=f,X=v,Q=b,te=h,ie=m,ne=x("v-date-picker"),Ne=x("RouterLink"),Fe=y,ze=g,Ge=C,Ke=S,We=k,Xe=p,Je=f;return I(),O("div",re,[B(K,{open:H(Y),title:"Change Acceptable",actions:"center",onClose:H(T)},{content:q((()=>[E("div",ce,[B(V,{modelValue:H(w),"onUpdate:modelValue":u[0]||(u[0]=e=>P(w)?w.value=e:null),name:"acceptable",options:$e,class:"is-primary-focus","value-prop":"value",disabled:H(s)},null,8,["modelValue","disabled"])])])),action:q((()=>[B(A,{disabled:H(s),color:"primary",raised:"",onClick:H(_)},{default:q((()=>[de])),_:1},8,["disabled","onClick"])])),_:1},8,["open","onClose"]),B(Ge,{"can-searchable":!1,headers:H(l),data:H(t),total:H(i),"is-loading":H(s),"is-action":H(ee)},{"custom-left":q((()=>[E("div",ue,[E("div",pe,[E("div",me,[B(te,null,{default:q((()=>[B(Q,null,{default:q((()=>[B(X,{modelValue:H(D),"onUpdate:modelValue":u[1]||(u[1]=e=>P(D)?D.value=e:null),label:"Search Date?",color:"primary",onChange:H(a)},null,8,["modelValue","onChange"])])),_:1})])),_:1}),B(te,{class:"ml-4"},{default:q((()=>[B(Q,null,{default:q((()=>[B(X,{modelValue:H(d).lessThanSixHours,"onUpdate:modelValue":u[2]||(u[2]=e=>H(d).lessThanSixHours=e),label:"Less than 6 hrs & return ticket?",color:"primary",onChange:H(a)},null,8,["modelValue","onChange"])])),_:1})])),_:1})]),H(o)?(I(),O("div",fe,[B(ne,{modelValue:H(d).datetime,"onUpdate:modelValue":u[3]||(u[3]=e=>H(d).datetime=e),"model-config":{type:"string",mask:"YYYY-MM-DD HH:mm"},masks:{inputDateTime24hr:"DD/MM/YYYY HH:mm"},mode:"dateTime",color:"orange","minute-increment":30,popover:{visibility:"click"},is24hr:""},{default:q((({inputValue:e,inputEvents:l})=>[ve,B(te,{addons:""},{default:q((()=>[B(Q,null,{default:q((()=>[E("input",L({disabled:!H(D),class:"input",value:e},U(l)),null,16,be)])),_:2},1024),B(Q,null,{default:q((()=>[B(ie,{disabled:!H(D),color:"warning",icon:"feather:search",outlined:"",onClick:H(a)},null,8,["disabled","onClick"])])),_:1})])),_:2},1024)])),_:1},8,["modelValue"])])):(I(),O("div",he,[B(ne,{modelValue:H(d).range,"onUpdate:modelValue":u[4]||(u[4]=e=>H(d).range=e),"is-range":"",color:"orange","trim-weeks":"","model-config":{start:{type:"string",mask:"YYYY-MM-DD",timeAdjust:"00:00:00"},end:{type:"string",mask:"YYYY-MM-DD",timeAdjust:"00:00:00"}},masks:{input:"DD/MM/YYYY"},popover:{visibility:"click"}},{default:q((({inputValue:e,inputEvents:l})=>[ye,B(te,{addons:""},{default:q((()=>[B(Q,null,{default:q((()=>[E("input",L({disabled:!H(D),value:e.start,class:"input"},U(l.start)),null,16,ge)])),_:2},1024),B(Q,null,{default:q((()=>[B(ie,{icon:"feather:arrow-right",class:"is-static"})])),_:1}),B(Q,null,{default:q((()=>[E("input",L({disabled:!H(D),value:e.end,class:"input"},U(l.end)),null,16,Ce)])),_:2},1024),B(Q,null,{default:q((()=>[B(ie,{disabled:!H(D),color:"warning",icon:"feather:search",outlined:"",onClick:H(a)},null,8,["disabled","onClick"])])),_:1})])),_:2},1024)])),_:1},8,["modelValue"])])),E("div",Se,[B(te,null,{default:q((()=>[B(Q,null,{default:q((()=>[B(X,{modelValue:H(o),"onUpdate:modelValue":u[5]||(u[5]=e=>P(o)?o.value=e:null),class:"pb-1",label:"Switch to "+(H(o)?"Date range":"Datetime"),color:"primary",disabled:!H(D)},null,8,["modelValue","label","disabled"])])),_:1})])),_:1})]),E("div",ke,[B(te,null,{default:q((()=>[De,B(Q,{icon:"feather:search"},{default:q((()=>[$(E("input",{"onUpdate:modelValue":u[6]||(u[6]=e=>H(d).search=e),type:"text",class:"input is-rounded",placeholder:"Search by Report ID, Class ID, Student Name & Phone, Coach Name",onChange:u[7]||(u[7]=(...e)=>H(a)&&H(a)(...e))},null,544),[[N,H(d).search]])])),_:1})])),_:1})])])])])),admin:q((({value:e})=>[(null==e?void 0:e.name)?(I(),O("p",Ye,F(e.name),1)):(I(),O("p",we,"-"))])),coach:q((({value:e})=>[B(Ne,{to:{name:"coaches-info-:id",params:{id:`${e.classroom.coach.id}`}},target:"_blank",class:"link"},{default:q((()=>[z(F(`(ID: ${e.classroom.coach.id}) ${e.classroom.coach.nickname}`),1)])),_:2},1032,["to"])])),student:q((({value:e})=>[B(Ne,{to:`/students/${e.classroom.student.id}`,target:"_blank",class:"link"},{default:q((()=>[z(F(`(ID: ${e.classroom.student.id}) ${e.classroom.student.fullnameTh||e.classroom.student.fullnameEn} (Tel: ${e.classroom.student.phone||"-"})`),1)])),_:2},1032,["to"])])),classroom:q((({value:e})=>[z(F(e.id),1)])),classTime:q((({value:e})=>{var a;return[z(F((null==(a=e.classroom)?void 0:a.classTime)?H(ae)(e.classroom.classTime,"DD/MM/YYYY HH:mm"):"-"),1)]})),studentSatisfaction:q((({value:e})=>[null!=e?(I(),G(Fe,{key:0,color:"green"===e?"success":"red"===e?"danger":"light",label:le(e),curved:""},null,8,["color","label"])):(I(),O("div",Ve,"-"))])),cancellationTime:q((({value:e})=>[z(F(e?H(se)(e):"-"),1)])),ticketReturn:q((({value:e})=>[null!=e?(I(),G(Fe,{key:0,color:"yes"===e?"success":"no"===e?"danger":"primary",label:le(e),curved:""},null,8,["color","label"])):(I(),O("div",Re,"-"))])),acceptable:q((({value:e})=>[z(F(e||"-"),1)])),reason:q((({value:e})=>{var a;return[E("p",null,F((null==(a=e[0])?void 0:a.name)||"-"),1)]})),action:q((({value:e})=>[E("div",_e,[B(ze,null,{content:q((()=>[H(Z).canViewclassreportCancel?(I(),O("a",{key:0,role:"menuitem",class:"dropdown-item is-media",onClick:a=>Ue(e.classroom.id,!0)},je,8,Te)):W("",!0),H(Z).canEditCancelReport?(I(),O("a",{key:1,role:"menuitem",class:"dropdown-item is-media",onClick:a=>Ue(e.classroom.id,!1)},Ae,8,Me)):W("",!0),H(Z).canEditCancelReportAcceptable?(I(),O("a",{key:2,role:"menuitem",class:"dropdown-item is-media",onClick:a=>H(R)(e.id,e.classroom.id,(null==e?void 0:e.acceptable)||"-")},Ie,8,xe)):W("",!0),H(Z).canVoidCancelReport?(I(),O("a",{key:3,role:"menuitem",class:"dropdown-item is-media",onClick:a=>{return l=e.classroom.id,r.value=l,void(c.value=!0);var l}},Be,8,Oe)):W("",!0)])),_:2},1024)])])),_:1},8,["headers","data","total","is-loading","is-action"]),B(Ke,{modelValue:He.value,"onUpdate:modelValue":[u[8]||(u[8]=e=>He.value=e),u[9]||(u[9]=e=>He.value=e)],readonly:Pe.value,"class-id":H(j),"cancel-report":H(M),onSavedReport:u[10]||(u[10]=e=>H(J)(H(oe).CANCEL_REPORT))},null,8,["modelValue","readonly","class-id","cancel-report"]),B(Je,{title:"Confirm Void Report",open:H(c),size:"small",actions:"center",onClose:Le},{content:q((()=>[B(We,{subtitle:`You want to void report, Class ID: ${H(r)}`},null,8,["subtitle"])])),action:q((()=>[B(Xe,{color:"primary",raised:"",loading:e.isVoiding,onClick:u[11]||(u[11]=e=>H(n)(H(r)))},{default:q((()=>[qe])),_:1},8,["loading"])])),cancel:q((()=>[B(Xe,{raised:"",onClick:Le},{default:q((()=>[Ee])),_:1})])),_:1},8,["open"])])}}});He.__scopeId="data-v-3b56c58c";export default He;
