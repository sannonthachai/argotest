var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(a,s,l)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[s]=l,u=(e,a)=>{for(var s in a||(a={}))t.call(a,s)&&r(e,s,a[s]);if(l)for(var s of l(a))i.call(a,s)&&r(e,s,a[s]);return e},o=(e,l)=>a(e,s(l));import{g as n,c as d,e as c}from"./index.d7dc1ff6.js";import{_ as v}from"./ValidateMessageBox.vue_vue&type=script&setup=true&lang.ac2d19e3.js";import{_ as p,a as m}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as f}from"./SelectOption.vue_vue&type=script&setup=true&lang.934e0be4.js";import{_ as g}from"./VIMaskInput.vue_vue&type=script&lang.eddb2771.js";import{_ as y}from"./QuizSlugSelect.vue_vue&type=script&setup=true&lang.2ce454e8.js";import{_ as h}from"./TextEditor.7b24ebe1.js";import{_ as I}from"./FormTemplate.a6fb27bf.js";import{p as z,a as b,d as V,r as S,k as Q,E as _,o as k,y as q,F as w,x as j,g as O,h as P,K as B,ai as L,e as C,t as E,i as T,H as U,G as R,q as N,A as x,b as $,ae as A}from"./vendor.1c8b4573.js";import{b as F,Q as D,c as G,d as M,F as H}from"./quiz.enum.fc8b95fc.js";import{u as K}from"./useOptionApi.f4dc99b9.js";import{a as J,b as W,g as X}from"./quiz.helper.1fae50f8.js";import{u as Y}from"./useQuizApi.3259bcc4.js";import{u as Z}from"./useNotyf.ddf08f06.js";z("data-v-08a2c862");const ee=R("Cancel"),ae=R("Submit"),se={class:"columns is-multiline"},le={class:"column is-12"},te=P("label",null,"Name",-1),ie={key:0,class:"help is-danger"},re={class:"column is-3"},ue=P("label",null,"Product Type",-1),oe={key:0,class:"help is-danger"},ne={class:"column is-3"},de=P("label",null,"G-Level/Kids Level",-1),ce={key:0,class:"help is-danger"},ve={class:"column is-3"},pe=P("label",null,"Type",-1),me={key:0,class:"help is-danger"},fe={class:"column is-3"},ge=P("label",null,"Status",-1),ye={key:0,class:"help is-danger"},he={class:"column is-5"},Ie=P("label",null,"Version",-1),ze={key:0,class:"help is-danger"},be=P("div",{class:"is-divider"},null,-1),Ve={class:"subtitle is-5"},Se={class:"columns is-multiline"},Qe={key:0,class:"column is-4"},_e=R("Timer "),ke={key:0,class:"help is-danger"},qe={key:1,class:"column is-6"},we={class:"label"},je=R(" Slug "),Oe={key:0},Pe={class:"column is-4"},Be=P("label",null,"organizationId",-1),Le={key:0,class:"help is-danger"},Ce={class:"column is-4"},Ee={key:0,class:"help is-danger"},Te={class:"column is-4"},Ue=P("label",null,"Integration key",-1),Re={key:0,class:"help is-danger"},Ne=P("div",{class:"is-divider"},null,-1),xe={class:"columns is-multitline"},$e={class:"column is-12"},Ae={key:0,class:"help is-danger"};b();var Fe=V({props:{quizInfo:{type:Object,default:void 0},validate:{type:Object,default:void 0}},emits:["create","update"],setup(e,{emit:a}){var s,l,t,i,r,o,c,z,b,V,R,N,x,$,A;const X=e,Y=S({name:(null==(s=X.quizInfo)?void 0:s.name)||"",level:(null==(l=X.quizInfo)?void 0:l.level)||F.PRE_GLOBISH,describe:null==(t=X.quizInfo)?void 0:t.describe,type:(null==(i=X.quizInfo)?void 0:i.type)||D.PRETEST,productType:(null==(r=X.quizInfo)?void 0:r.productType)||G.ADULT,status:(null==(o=X.quizInfo)?void 0:o.status)||M.DRAFT,timer:(null==(c=X.quizInfo)?void 0:c.timer)||"",formatVersion:(null==(z=X.quizInfo)?void 0:z.formatVersion)||H.VERSION3,slug:(null==(b=X.quizInfo)?void 0:b.slug)||"",organizationId:null==(R=null==(V=X.quizInfo)?void 0:V.json)?void 0:R.organizationId,taskId:null==(x=null==(N=X.quizInfo)?void 0:N.json)?void 0:x.taskId,secret:null==(A=null==($=X.quizInfo)?void 0:$.json)?void 0:A.secret}),Z=Q((()=>!!X.quizInfo)),Fe=Q((()=>Y.value.timer)),De=Q((()=>Y.value.slug)),Ge=Q((()=>Y.value.organizationId&&Y.value.taskId&&Y.value.secret)),Me=Q((()=>Y.value.formatVersion===H.VERSION1?Fe.value:Y.value.formatVersion===H.VERSION4?Ge.value:De.value)),He=Q((()=>!!(Y.value.name&&Y.value.type&&Y.value.level&&Y.value.productType&&Y.value.status&&Y.value.formatVersion&&Me.value))),Ke=Q((()=>J(Y.value.formatVersion))),{user:Je}=n(),{getQuizLevel:We}=K();S((null==Je?void 0:Je.manageCountry)||[]);const Xe=S(Object.values(D)),Ye=S(Object.values(M)),Ze=S(Object.values(G)),ea=S(W),aa=()=>{Z.value&&X.quizInfo?a("update",u({id:X.quizInfo.id},Y.value)):a("create",Y.value)},sa=e=>{e!==H.VERSION4&&(Y.value.organizationId=Y.value.taskId=Y.value.secret=void 0),e!==H.VERSION3&&(Y.value.slug=""),e!==H.VERSION1&&(Y.value.timer="")},la=e=>null==e?void 0:e.replace(/ /g,""),ta=e=>{Y.value.organizationId=la(Y.value.organizationId)},ia=()=>{Y.value.taskId=la(Y.value.taskId)},ra=e=>{Y.value.secret=la(Y.value.secret)};return(a,s)=>{var l;const t=d,i=v,r=p,u=m,o=_("Multiselect"),n=f,c=g,z=y,b=h,V=I;return k(),q(V,{"is-stuck-header":!1,title:O(Z)?`Edit ${null==(l=e.quizInfo)?void 0:l.name}`:"Create New Quiz"},{buttons:w((()=>[j(t,{icon:"feather:arrow-left",onClick:s[0]||(s[0]=e=>a.$router.go(-1))},{default:w((()=>[ee])),_:1}),j(t,{icon:O(Z)?"feather:edit":"feather:check",color:"primary",disabled:!O(He),onClick:aa},{default:w((()=>[ae])),_:1},8,["icon","disabled"])])),default:w((()=>[P("div",null,[j(i,{validate:e.validate},null,8,["validate"]),P("div",se,[P("div",le,[j(u,null,{default:w((()=>{var a;return[te,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.name)},{default:w((()=>{var a;return[B(P("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>Y.value.name=e),type:"text",name:"quiz_name",class:"input"},null,512),[[L,Y.value.name]]),(null==(a=e.validate)?void 0:a.name)?(k(),C("p",ie,E(e.validate.name),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})]),P("div",re,[j(u,null,{default:w((()=>{var a;return[ue,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.productType)},{default:w((()=>{var a;return[j(o,{modelValue:Y.value.productType,"onUpdate:modelValue":s[2]||(s[2]=e=>Y.value.productType=e),options:Ze.value,name:"quiz_type","can-clear":!1},null,8,["modelValue","options"]),(null==(a=e.validate)?void 0:a.productType)?(k(),C("p",oe,E(e.validate.productType),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})]),P("div",ne,[j(u,null,{default:w((()=>{var a;return[de,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.level)},{default:w((()=>{var a;return[j(n,{modelValue:Y.value.level,"onUpdate:modelValue":s[3]||(s[3]=e=>Y.value.level=e),"callback-search":O(We),"is-show-id":!1,"can-clear":!1},null,8,["modelValue","callback-search"]),(null==(a=e.validate)?void 0:a.level)?(k(),C("p",ce,E(e.validate.level),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})]),P("div",ve,[j(u,null,{default:w((()=>{var a;return[pe,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.type)},{default:w((()=>{var a;return[j(o,{modelValue:Y.value.type,"onUpdate:modelValue":s[4]||(s[4]=e=>Y.value.type=e),options:Xe.value,name:"quiz_type","can-clear":!1},null,8,["modelValue","options"]),(null==(a=e.validate)?void 0:a.type)?(k(),C("p",me,E(e.validate.type),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})]),P("div",fe,[j(u,{class:"is-autocomplete-select"},{default:w((()=>{var a;return[ge,j(r,{key:Y.value.status,icon:"published"===Y.value.status?"feather:check-square":"feather:pen-tool","has-error":!!(null==(a=e.validate)?void 0:a.status)},{default:w((()=>{var a;return[j(o,{modelValue:Y.value.status,"onUpdate:modelValue":s[5]||(s[5]=e=>Y.value.status=e),options:Ye.value,"can-clear":!1},null,8,["modelValue","options"]),(null==(a=e.validate)?void 0:a.status)?(k(),C("p",ye,E(e.validate.status),1)):T("",!0)]})),_:1},8,["icon","has-error"])]})),_:1})]),P("div",he,[j(u,null,{default:w((()=>{var a;return[Ie,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.formatVersion)},{default:w((()=>{var a;return[j(o,{modelValue:Y.value.formatVersion,"onUpdate:modelValue":s[6]||(s[6]=e=>Y.value.formatVersion=e),options:ea.value,name:"quiz_version","can-clear":!1,"can-deselect":!1,onInput:sa},null,8,["modelValue","options"]),(null==(a=e.validate)?void 0:a.formatVersion)?(k(),C("p",ze,E(e.validate.formatVersion),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})])]),be,P("h3",Ve,E(O(Ke))+" (Version "+E(Y.value.formatVersion)+") ",1),P("div",Se,[Y.value.formatVersion===O(H).VERSION1?(k(),C("div",Qe,[j(u,null,{default:w((()=>{var a;return[P("label",null,[_e,P("span",null,E(Y.value.timer),1)]),void 0!==Y.value.timer?(k(),q(r,{key:0,"has-error":!!(null==(a=e.validate)?void 0:a.timer)},{default:w((()=>{var a;return[j(c,{modelValue:Y.value.timer,"onUpdate:modelValue":s[7]||(s[7]=e=>Y.value.timer=e),class:"input",options:{mask:"00:00:00"},placeholder:"hh:mm:ss"},null,8,["modelValue"]),(null==(a=e.validate)?void 0:a.timer)?(k(),C("p",ke,E(e.validate.timer),1)):T("",!0)]})),_:1},8,["has-error"])):T("",!0)]})),_:1})])):T("",!0),Y.value.formatVersion===O(H).VERSION3?(k(),C("div",qe,[P("p",we,[je,Y.value.slug?(k(),C("span",Oe,"("+E(Y.value.slug)+")",1)):T("",!0)]),j(z,{modelValue:Y.value.slug,"onUpdate:modelValue":s[8]||(s[8]=e=>Y.value.slug=e)},null,8,["modelValue"])])):T("",!0),Y.value.formatVersion===O(H).VERSION4?(k(),C(U,{key:2},[P("div",Pe,[j(u,null,{default:w((()=>{var a;return[Be,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.organizationId)},{default:w((()=>{var a;return[B(P("input",{"onUpdate:modelValue":[s[9]||(s[9]=e=>Y.value.organizationId=e),ta],type:"text",name:"organizationId",class:"input"},null,512),[[L,Y.value.organizationId,void 0,{trim:!0}]]),(null==(a=e.validate)?void 0:a.organizationId)?(k(),C("p",Le,E(e.validate.organizationId),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})]),P("div",Ce,[j(u,null,{default:w((()=>{var a;return[P("label",null,"taskId "+E(Y.value.taskId),1),j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.taskId)},{default:w((()=>{var a;return[B(P("input",{"onUpdate:modelValue":[s[10]||(s[10]=e=>Y.value.taskId=e),ia],type:"text",name:"taskId",class:"input"},null,512),[[L,Y.value.taskId,void 0,{trim:!0}]]),(null==(a=e.validate)?void 0:a.taskId)?(k(),C("p",Ee,E(e.validate.taskId),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})]),P("div",Te,[j(u,null,{default:w((()=>{var a;return[Ue,j(r,{"has-error":!!(null==(a=e.validate)?void 0:a.secret)},{default:w((()=>{var a;return[B(P("input",{"onUpdate:modelValue":[s[11]||(s[11]=e=>Y.value.secret=e),ra],type:"text",name:"secret",class:"input"},null,512),[[L,Y.value.secret,void 0,{trim:!0}]]),(null==(a=e.validate)?void 0:a.secret)?(k(),C("p",Re,E(e.validate.secret),1)):T("",!0)]})),_:1},8,["has-error"])]})),_:1})])],64)):T("",!0)]),Ne,P("div",xe,[P("div",$e,[j(u,null,{default:w((()=>[j(r,null,{default:w((()=>{var a;return[j(b,{modelValue:Y.value.describe,"onUpdate:modelValue":[s[12]||(s[12]=e=>Y.value.describe=e),s[13]||(s[13]=e=>Y.value.describe=e)],label:"Describe"},null,8,["modelValue"]),(null==(a=e.validate)?void 0:a.describe)?(k(),C("p",Ae,E(e.validate.describe),1)):T("",!0)]})),_:1})])),_:1})])])])])),_:1},8,["title"])}}});function De(){const e=N({isLoading:!1,quizInfo:void 0,quizSections:[],questions:[],groupingQuestionsByParagraph:[],validate:{},currentSection:void 0,currentQuestion:void 0,paragraphInfoList:[]}),a=x(),s=$(),l=Z(),{createQuizInfo:t,getQuizInfoById:i,editQuizInfoById:r,getSectionsByQuizId:n,createQuizSectionsByQuizId:d,updateQuizSectionsById:v,removeQuizSectionsById:p,createQuestionBySectionId:m,updateQuestionById:f,removeQuestionById:g,getQuestionsBySectionId:y,getParagraphById:h,createParagraphBySectionId:I,updateParagraphById:z,removeParagraphById:b,createQuestionOfParagraph:V,updateQuestionOfParagraph:S,createChoicesByQuestionId:_,updateChoiceById:k,removeChoiceById:q}=Y(),w=Q((()=>"#edit"===a.hash)),j=Q((()=>parseInt(a.params.id))),O=a=>{"object"==typeof a?e.validate=a:l.error(c(a))},P=async()=>{e.isLoading=!0;const a=await n(j.value);e.isLoading=!1,e.quizSections=a.sort(((e,a)=>e.index-a.index))},B=async(e,a=!0)=>{const{error:s,message:t}=await v(e);a&&(s?O(t):(l.success("Section Updated Success!"),P()))},L=async()=>{var a,s;(null==(a=e.currentSection)?void 0:a.id)&&(e.isLoading=!0,e.questions=await y(null==(s=e.currentSection)?void 0:s.id),e.groupingQuestionsByParagraph=await X(e.questions),(async()=>{e.groupingQuestionsByParagraph.map((async a=>{const s=await h(a.id);void 0!==s&&e.paragraphInfoList.push(s)}))})(),e.currentQuestion=void 0,e.validate={},e.isLoading=!1)},C=async(e,a=!0)=>{const{error:s,message:t}=await k(e);s?l.error(c(t)):(a&&l.success("Updated Choices Success!"),L())},E=async e=>{const a=e.choices.filter((e=>!e.id));if(!a.length)return;const{error:s,message:t}=await _(o(u({},e),{choices:a}));s?l.error(c(t)):l.success("Created Choices Success!")},T=async(e,a)=>{const s=e.filter((e=>!!e.id));await Promise.all([E({questionId:a,choices:e})]),await Promise.all(s.map((async e=>await C(e,!1))))};return o(u({},A(e)),{quizId:j,fetchQuizInfo:async()=>{e.isLoading=!0;const a=await i(j.value);e.isLoading=!1,e.quizInfo=a},fetchQuizSection:P,createNewQuizInfo:async a=>{const{error:l,message:i,data:r}=await t(a);l?O(i):(e.validate={},s.push({name:"quizzes-:id",params:{id:`${r.id}`}}))},updateQuizInfo:async a=>{const{data:t,error:i,message:u}=await r(a);i?O(u):(e.validate={},l.success("Updated Success!"),s.push({name:"quizzes-:id",params:{id:`${t.id}`}}))},isEdit:w,createSectionsOfQuiz:async a=>{const{error:s,message:t}=await d(j.value,a);s?O(t):(e.validate={},l.success("Create New Section Success!"),P())},updateSectionInfo:B,removeSectionInfo:async e=>{const{error:a,message:s}=await p(e.id);a?l.error(c(s)):(l.success(`Remove ${e.name} Section Success!`),P())},changeSectionIndex:e=>{Promise.all(e.map((e=>B(e,!1))))},createQuestion:async a=>{if(a.id)return void(async e=>{const{data:a,error:s,message:t}=await f(e);s?O(t):(l.success("Updated Question Success!"),e.choices&&await T(e.choices,a.id),await L())})(a);e.isLoading=!0;const{data:s,error:t,message:i}=await m(a);e.isLoading=!1,t?O(i):(l.success("Created Question Success!"),a.choices&&await E({questionId:s.id,choices:a.choices}),L())},fetchQuestions:L,removeQuestion:async e=>{const{error:a,message:s}=await g(e.question.id);a?l.error(c(s)):(l.success(`Remove ${e.question.name} Success!`),L())},updateChoice:C,removeChoice:async e=>{const{error:a,message:s}=await q(e.id);return a?l.error(c(s)):(l.success("Remove Choice Success!"),L()),!a},updateParagraph:async a=>{var s,t;if(!(a.id||(null==(s=e.currentQuestion)?void 0:s.firstSentence)&&(null==(t=e.currentQuestion)?void 0:t.lastSentence)))return void l.warning("Please fill first question of paragraph");e.isLoading=!0;const{data:i,message:r,error:n}=await(e=>e.id?z(e):I(e))(a);if(e.isLoading=!1,!n&&e.currentQuestion){e.validate={},e.currentQuestion=o(u({},e.currentQuestion),{paragraphId:i.id}),e.isLoading=!0;const a=await(()=>{if(e.currentQuestion)return e.currentQuestion.id?S(e.currentQuestion):V(e.currentQuestion)})();if(e.isLoading=!1,(null==a?void 0:a.error)&&O(null==a?void 0:a.message),!e.currentQuestion.choices)return;e.isLoading=!0,await T(e.currentQuestion.choices,null==a?void 0:a.data.id),e.isLoading=!1,L()}else l.error(c(r))},removeParagraph:async e=>{const{error:a,message:s}=await b(e.id);a?l.error(c(s)):(l.success("Remove Paragraph Success!"),L())},changeCurrentSection:a=>{e.currentSection=a},changeCurrentQuestion:a=>{e.currentQuestion=a,e.validate={}}})}Fe.__scopeId="data-v-08a2c862";export{Fe as _,De as u};
