var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;import{d as r,e as i,c as u,a as d}from"./index.d7dc1ff6.js";import{_ as n}from"./VSwitchBlock.vue_vue&type=script&setup=true&lang.fd20ebd0.js";import{_ as p,a as m}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as g}from"./VCheckbox.0efaaab1.js";import{_ as f}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{_ as y}from"./VPlaceholderSection.vue_vue&type=script&setup=true&lang.35b0ad2a.js";import{_ as v}from"./VLoader.vue_vue&type=script&setup=true&lang.a96d7daf.js";import{_ as h}from"./VTag.vue_vue&type=script&setup=true&lang.b31af8ee.js";import{_ as P}from"./VTags.vue_vue&type=script&setup=true&lang.156e160d.js";import{q as C,A,ae as b,p as _,a as I,d as L,r as w,S as j,Y as V,E as k,o as $,y as B,F as S,h as T,t as x,g as O,x as E,i as D,O as U,e as H,K as N,V as F,I as z,H as M,U as q,G}from"./vendor.1c8b4573.js";import{_ as K,a as R}from"./search-4-dark.fb3880a5.js";import{u as Y}from"./useOptionApi.f4dc99b9.js";import{u as J}from"./useGuardCoach.2473a459.js";import{u as Q}from"./useCoachApi.4bab1366.js";import{u as W}from"./useNotyf.ddf08f06.js";import{S as X}from"./coach.enum.0ff8980c.js";function Z(){const e=C({accessList:[],editAccessList:[],isLoading:!1,currentPage:1,totalPage:1,search:"",debounce:null,isProduct:!1,isCreate:!1,coachCategory:0,status:null}),{createCoachAccessByProductId:u,createProductAccessByCoachId:d,deleteCoachAccessByProductId:n,deleteProductAccessByCoachId:p,getCoachAccessByProductId:m,getProductAccessByCoachId:g}=function(){const e=r();return{getProductAccessByCoachId:async(a,s)=>e.get(`/ProductAccess/${s}`,{params:a}),createProductAccessByCoachId:(a,s)=>e.post(`/ProductAccess/${a}`,s),deleteProductAccessByCoachId:(a,s)=>e.delete(`/ProductAccess/${a}`,{data:s}),getCoachAccessByProductId:(a,s)=>e.get(`/CoachAccess/${s}`,{params:a}),createCoachAccessByProductId:(a,s)=>e.post(`/CoachAccess/${a}`,s),deleteCoachAccessByProductId:(a,s)=>e.delete(`/CoachAccess/${a}`,{data:s})}}(),{getAllCoaches:f}=Q(),y=A(),v=W(),h=async()=>{e.isLoading=!0;const a={currentPage:1,perPage:20,search:e.search,isCreate:!0};if(e.isProduct){null!==e.status&&(a.status=e.status),e.isCreate||(a.isCreate=!1);const{data:s}=await g(a,`${y.params.id}`);e.accessList=_((null==s?void 0:s.data)||[]),e.totalPage=(null==s?void 0:s.totalPage)||1}else if(null!==e.status&&(a.status=e.status),e.coachCategory&&(a.categoryId=e.coachCategory),y.params.productid){e.isCreate||(a.isCreate=!1);const{data:s}=await m(a,`${y.params.productid}`);e.accessList=P((null==s?void 0:s.data)||[]),e.totalPage=(null==s?void 0:s.totalPage)||1}else{const{currentPage:s,perPage:t,search:c,status:l,categoryId:o}=a,r=await f({currentPage:s,perPage:t,search:c,status:l,categoryId:o});e.accessList=I((null==r?void 0:r.data)||[]),e.totalPage=(null==r?void 0:r.totalPage)||1}e.currentPage=2,e.isLoading=!1},P=e=>e.map((e=>({id:e.id,name:e.name||e.fullname,subName:e.gender,type:e.category,subType:e.experience,imageUrl:e.avatar}))),_=e=>e.map((e=>({id:e.id,name:e.name,subName:e.type,type:e.price?e.price.toLocaleString(void 0,{minimumFractionDigits:2}):"",subType:e.duration?`${e.duration}`:""}))),I=e=>e.map((e=>({id:e.id,name:e.nickname,subName:e.gender,type:e.category,subType:e.teachingExp,imageUrl:e.avatar})));return L=((e,a)=>{for(var s in a||(a={}))c.call(a,s)&&o(e,s,a[s]);if(t)for(var s of t(a))l.call(a,s)&&o(e,s,a[s]);return e})({},b(e)),a(L,s({loadMore:async()=>{e.isLoading=!0;const a={currentPage:e.currentPage,perPage:20,search:e.search,isCreate:!0};if(e.isProduct){e.isCreate||(a.isCreate=!1);const{data:s}=await g(a,`${y.params.id}`);e.accessList=[...e.accessList,..._(s.data||[])],e.totalPage=s.totalPage||1}else if(e.coachCategory&&(a.categoryId=e.coachCategory),null!==e.status&&(a.status=e.status),y.params.productid){e.isCreate||(a.isCreate=!1);const{data:s}=await m(a,`${y.params.productid}`);e.accessList=[...e.accessList,...P((null==s?void 0:s.data)||[])],e.totalPage=(null==s?void 0:s.totalPage)||1}else{const{currentPage:s,perPage:t,search:c,status:l,categoryId:o}=a,r=await f({currentPage:s,perPage:t,search:c,status:l,categoryId:o});e.accessList=[...e.accessList,...I((null==r?void 0:r.data)||[])],e.totalPage=(null==r?void 0:r.totalPage)||1}e.isLoading=!1},removeEditAccessList:a=>{e.editAccessList.splice(a,1)},debounceSearch:a=>{clearTimeout(e.debounce),e.debounce=setTimeout((()=>{e.search=a.target.value}),600)},saveProduct:async()=>{const a={productIds:e.editAccessList.map((e=>parseInt(e.split("|")[0])))};if(e.isCreate){const{message:e,status:s}=await d(`${y.params.id}`,a);201===s?v.success("Create product access success!"):v.error(i(e))}else{const{message:e,status:s}=await p(`${y.params.id}`,a);200===s?v.success("Delete product access success!"):v.error(i(e))}e.editAccessList=[],await h()},replaceState:h,saveCoach:async()=>{const a={coachIds:e.editAccessList.map((e=>parseInt(e.split("|")[0])))};if(e.isCreate){const{message:e,status:s}=await u(`${y.params.productid}`,a);201===s?v.success("Create product access success!"):v.error(i(e))}else if(e.editAccessList.length>0){const{message:e,status:s}=await n(`${y.params.productid}`,a);200===s?v.success("Delete product access success!"):v.error(i(e))}e.editAccessList=[]}}));var L}_("data-v-e451c42e");const ee={class:"is-flex is-justify-content-space-between"},ae={class:"subtitle mb-5"},se=G("Edit"),te=T("label",null,"Status Filter",-1),ce=T("label",null,"Category Filter",-1),le=["placeholder"],oe={class:"columns w-100 m-0"},re={class:"column is-6 column-font"},ie={class:"column is-3 column-font"},ue={class:"column column-font"},de={key:0,class:"column is-1"},ne={class:"list-group-wrapper"},pe={class:"column is-6 is-flex is-align-self-center"},me={class:"coach-name-font"},ge={class:"column is-3 is-flex is-align-self-center"},fe={class:"column is-flex is-align-self-center"},ye={key:0,class:"column is-1 is-flex is-align-self-center"},ve=T("img",{class:"light-image",src:K,alt:""},null,-1),he=T("img",{class:"dark-image",src:R,alt:""},null,-1),Pe={key:0,class:"mt-5 is-flex is-justify-content-flex-end"},Ce=G("Cancel"),Ae=G("Save");I();var be=L({props:{title:{type:String,default:""},columnsHeader:{type:Array,default:()=>[]},searchPlaceholder:{type:String,default:""},searchTitle:{type:String,default:""},isProductAccess:{type:Boolean,default:!1},edit:{type:Boolean,default:!1},create:{type:Boolean,default:!1},productAction:{type:Boolean,default:!1}},emits:["update:edit"],setup(e,{emit:a}){const s=e,{capabilities:t}=J(),{getCoachesCategory:c}=Y(),{accessList:l,editAccessList:o,isLoading:r,currentPage:i,totalPage:C,isProduct:A,isCreate:b,coachCategory:_,search:I,status:L,debounceSearch:G,loadMore:K,removeEditAccessList:R,saveProduct:Q,replaceState:W,saveCoach:be}=Z(),_e=async()=>{a("update:edit",!1),o.value=[],b.value=!1,await W()},Ie=w([]),Le=w([{}]),we=w(null);j((()=>s.productAction),(async(e,a)=>{await be()})),j([_,I,L],(async(e,a)=>{await W()})),j((()=>b.value),(async(e,a)=>{await W(),o.value=[]}));const je=e=>{clearTimeout(we.value),we.value=setTimeout((()=>{Q()}),600)};return V((async()=>{A.value=s.isProductAccess;const e=await c();Ie.value=e.map((e=>({label:e.name,value:e.id}))),Le.value=[{label:"Active",value:X.ACTIVE},{label:"Inactive",value:X.INACTIVE}];const a=document.querySelector("#infinite-list");null==a||a.addEventListener("scroll",(e=>{a.scrollTop+a.clientHeight>=a.scrollHeight&&i.value<=C.value&&(K(),i.value++)})),K(),i.value++})),(s,c)=>{const i=u,C=n,A=p,I=m,w=k("Multiselect"),j=d,V=g,K=f,Y=y,J=v,Q=h,W=P,X=p,Z=m;return $(),B(K,{class:"mb-3"},{default:S((()=>[T("div",ee,[T("p",ae,x(e.title),1),O(t).canCreateProductCoachAccess||O(t).canDeleteProductCoachAccess?($(),B(I,{key:0},{default:S((()=>[E(A,null,{default:S((()=>[e.isProductAccess&&!e.edit?($(),B(i,{key:0,color:"primary",icon:"feather:edit",onClick:c[0]||(c[0]=e=>a("update:edit",!0))},{default:S((()=>[se])),_:1})):D("",!0),!e.create&&(e.edit&&O(t).canCreateProductCoachAccess&&O(t).canDeleteProductCoachAccess)?($(),B(C,{key:1,modelValue:O(b),"onUpdate:modelValue":c[1]||(c[1]=e=>U(b)?b.value=e:null),class:"p-0",label:O(b)?"Add Access":"Remove Access",color:"primary"},null,8,["modelValue","label"])):D("",!0)])),_:1})])),_:1})):D("",!0)]),e.isProductAccess?D("",!0):($(),B(I,{key:0},{default:S((()=>[te,E(A,null,{default:S((()=>[E(w,{modelValue:O(L),"onUpdate:modelValue":c[2]||(c[2]=e=>U(L)?L.value=e:null),placeholder:"Choose Status",options:Le.value},null,8,["modelValue","options"])])),_:1})])),_:1})),e.isProductAccess?D("",!0):($(),B(I,{key:1},{default:S((()=>[ce,E(A,null,{default:S((()=>[E(w,{modelValue:O(_),"onUpdate:modelValue":c[3]||(c[3]=e=>U(_)?_.value=e:null),placeholder:"Choose Category",options:Ie.value},null,8,["modelValue","options"])])),_:1})])),_:1})),E(I,null,{default:S((()=>[T("label",null,x(e.searchTitle),1),E(A,{icon:"lnil lnil-zoom-in"},{default:S((()=>[T("input",{type:"text",class:"input",placeholder:e.searchPlaceholder,onInput:c[4]||(c[4]=(...e)=>O(G)&&O(G)(...e))},null,40,le)])),_:1})])),_:1}),T("div",oe,[T("div",re,x(e.columnsHeader[0]||""),1),T("div",ie,x(e.columnsHeader[1]||""),1),T("div",ue,x(e.columnsHeader[2]||""),1),e.edit&&(O(t).canCreateProductCoachAccess||O(t).canDeleteProductCoachAccess)?($(),H("div",de)):D("",!0)]),T("div",ne,[E(J,{size:"small",center:"regular",translucent:!0,active:O(r)},{default:S((()=>[N(E(K,{id:"infinite-list",class:"list-group",elevated:""},{default:S((()=>[($(!0),H(M,null,z(O(l),(a=>($(),B(K,{key:a,elevated:"",class:"columns list-border m-0"},{default:S((()=>[T("div",pe,[e.isProductAccess?D("",!0):($(),B(j,{key:0,picture:a.imageUrl,color:"info",size:"small",class:"coach-image-container"},null,8,["picture"])),T("div",null,[T("div",null,x(a.name||"-"),1),T("div",me,x(a.subName||"-"),1)])]),T("div",ge,x(a.type||"-"),1),T("div",fe,x(a.subType||"-"),1),e.edit&&(O(t).canCreateProductCoachAccess||O(t).canDeleteProductCoachAccess)?($(),H("div",ye,[E(V,{modelValue:O(o),"onUpdate:modelValue":c[5]||(c[5]=e=>U(o)?o.value=e:null),class:"p-0",value:`${a.id}|${a.name}`,color:O(b)?"success":"danger",circle:"",solid:""},null,8,["modelValue","value","color"])])):D("",!0)])),_:2},1024)))),128))])),_:1},512),[[F,0!==O(l).length]]),N(E(Y,{title:"No data to show",subtitle:"There is currently no data to show in this list."},{image:S((()=>[ve,he])),_:1},512),[[F,0===O(l).length]])])),_:1},8,["active"])]),E(q,{name:"slide-fade"},{default:S((()=>[O(o).length?($(),B(Z,{key:0,grouped:"",multiline:"",class:"r-card is-raised mt-5"},{default:S((()=>[($(!0),H(M,null,z(O(o),((e,a)=>($(),B(X,{key:e},{default:S((()=>[E(W,{addons:""},{default:S((()=>[E(Q,{label:`[Id: ${e.split("|")[0]}] ${e.split("|")[1]}`,color:O(b)?"success":"danger"},null,8,["label","color"]),E(Q,{remove:"",onClick:e=>O(R)(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})):D("",!0)])),_:1}),E(q,{name:"slide-fade"},{default:S((()=>[e.isProductAccess&&e.edit?($(),H("div",Pe,[E(i,{icon:"feather:arrow-left",onClick:_e},{default:S((()=>[Ce])),_:1}),E(i,{color:"primary",class:"ml-3",disabled:0===O(o).length,onClick:je},{default:S((()=>[Ae])),_:1},8,["disabled"])])):D("",!0)])),_:1})])),_:1})}}});be.__scopeId="data-v-e451c42e";export{be as _};
