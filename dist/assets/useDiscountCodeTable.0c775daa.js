var e=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,n=(a,o,t)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[o]=t;import{q as r,A as i,b as u,k as l,ae as d,D as p}from"./vendor.1c8b4573.js";import{u as g}from"./useDiscountCodeApi.241c4e94.js";import{u as P}from"./useOptionApi.f4dc99b9.js";import{u as C}from"./useNotyf.ddf08f06.js";import{u as k}from"./usePaginationRoute.780ca235.js";import{e as m}from"./index.d7dc1ff6.js";import{U as b,D as y,I as v,R as A}from"./discount-code.enum.6e9d29f6.js";function f(){const e=r({discountCodeList:[],couponDetail:void 0,couponCreate:{code:"",partnerId:0,expireDate:"",availableCoupon:1,useForAllPackage:b.NOT_USE_FOR_ALL_PACKAGE,discountType:y.PRICE,installment:v.CAN_NOT_PAY_INSTALLMENT,requireSomePackage:A.TRUE},studentUsedCoupon:[],isUseForAllPackage:!1,isInstallment:!1,isRequirePackage:!1,selectedPartner:1,selectedPackage:void 0,notForPackage:[],total:0,isLoading:!0,validate:{}}),f=i(),D=u(),E=C(),{perPage:T,currentPage:I,search:L}=k(),{getPartners:O,getPackages:S}=P(),{getAllDiscountCode:_,getDiscountCodeById:F,getStudentUsedCode:R,createDiscountCode:U,updateDiscountCode:h}=g(),N=l((()=>f.params.id)),j=l((()=>e.couponCreate.discountType===y.PERCENTAGE?100:void 0));return w=((e,a)=>{for(var o in a||(a={}))s.call(a,o)&&n(e,o,a[o]);if(t)for(var o of t(a))c.call(a,o)&&n(e,o,a[o]);return e})({},d(e)),a(w,o({discountCodeTableHeaders:[{key:"id",label:"ID"},{key:"code",label:"Code"},{key:"partner",label:"Partner"},{key:"couponPackages",label:"Discount",isRaw:!0},{key:"used",label:"Used/Available",isRaw:!0},{key:"expireDate",label:"Expire"},{key:"notForPackage",label:"Condition",isRaw:!0},{key:"installment",label:"Installment"}],studentUsedCouponTableHeaders:[{key:"id",label:"Order ID"},{key:"student",label:"Student"},{key:"packages",label:"Package"},{key:"createdAt",label:"Paid date"},{key:"price",label:"Price"},{key:"paidPrice",label:"Paid"}],fetchAllDiscountCode:async()=>{e.isLoading=!0;const a=await _({currentPage:I,perPage:T,search:L});e.isLoading=!1,e.discountCodeList=(null==a?void 0:a.data)||[],e.total=(null==a?void 0:a.total)||0},fetchDiscountCodeById:async()=>{const a=await F(+N.value);e.couponDetail=a},fetchStudentUsedCode:async()=>{e.isLoading=!0;const a=await R({id:+N.value,currentPage:I,perPage:T,search:L});e.isLoading=!1,e.studentUsedCoupon=(null==a?void 0:a.data)||[],e.total=(null==a?void 0:a.total)||0},createCoupon:async()=>{var a,o;if(e.couponCreate.partnerId=e.selectedPartner,e.isUseForAllPackage){if(e.notForPackage?e.couponCreate.notForPackage=null==(a=e.notForPackage)?void 0:a.map(String):e.couponCreate.notForPackage=void 0,e.couponCreate.discount&&(e.couponCreate.discountType===y.PERCENTAGE&&(null==(o=e.couponCreate)?void 0:o.discount)>100||e.couponCreate.discount<0))return void E.error("Discount has problem");e.couponCreate.requireSomePackage=A.TRUE,e.couponCreate.couponPackages=void 0}else{if(!e.couponCreate.couponPackages||0===e.couponCreate.couponPackages.length)return void E.error("Add package before submit");e.couponCreate.notForPackage=void 0,e.couponCreate.discount=void 0,e.couponCreate.discountType=void 0}const t=await U(e.couponCreate);201===t.status?(E.success("success!"),e.validate={},D.push({name:"codes-discount-codes"})):"object"==typeof t.message?e.validate=t.message:E.error(m(t.message))},updateCoupon:async()=>{if(!e.couponDetail)return;const a=await h(+N.value,{availableCoupon:e.couponDetail.availableCoupons,expireDate:p(e.couponDetail.expireDate).toISOString()});200===a.status?(E.success("success!"),e.validate={},D.push({name:"codes-discount-codes"})):"object"==typeof a.message?e.validate=a.message:E.error(m(a.message))},getPackages:S,addDiscountPackage:a=>{var o;e.couponCreate.couponPackages||(e.couponCreate.couponPackages=[]),null==(o=e.couponCreate.couponPackages)||o.push(a)},removeDiscountPackage:a=>{if(!e.couponCreate.couponPackages)return;const o=e.couponCreate.couponPackages.findIndex((e=>e.packageId===a));e.couponCreate.couponPackages.splice(o,1)},discountMax:j,checkUseForAllPackage:()=>{e.isUseForAllPackage?e.couponCreate.useForAllPackage=b.USE_FOR_ALL_PACKAGE:e.couponCreate.useForAllPackage=b.NOT_USE_FOR_ALL_PACKAGE},checkInstallment:()=>{e.isInstallment?e.couponCreate.installment=v.CAN_PAY_INSTALLMENT:e.couponCreate.installment=v.CAN_NOT_PAY_INSTALLMENT},checkRequireSomePackage:()=>{e.isRequirePackage?e.couponCreate.requireSomePackage=A.FALSE:e.couponCreate.requireSomePackage=A.TRUE},displaydiscountType:e=>e===y.PRICE?"฿":"%",displayInstallment:e=>1===e?"ใช้ผ่อนได้":"ใช้ผ่อนไม่ได้",viewDetail:e=>{D.push({name:"codes-discount-codes-:id",params:{id:e}})}}));var w}export{f as u};
