var e=Object.defineProperty,a=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(a,r,s)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s;import{c as i,g as l,h as c}from"./index.d7dc1ff6.js";import{_ as d}from"./Datatable.aae3ef08.js";import{_ as u}from"./SelectOption.vue_vue&type=script&setup=true&lang.934e0be4.js";import{_ as p}from"./VModal.31b4f4ba.js";import{u as m}from"./useOptionApi.f4dc99b9.js";import{p as f,a as b,d as h,r as g,o as v,y,F as P,h as U,x as C,g as j,G as w,q as k,A as _,Y as D,ae as A,z as I,au as L,e as S,i as O}from"./vendor.1c8b4573.js";import{_ as V}from"./ConfirmRemoveModal.3ba4d6d1.js";import{_ as B}from"./FormTemplate.a6fb27bf.js";import{u as F}from"./useGuardPartner.354c9ce1.js";import{u as $}from"./usePartnerApi.2e3c406b.js";import{u as x}from"./useNotyf.ddf08f06.js";import{u as H}from"./usePaginationRoute.780ca235.js";import{_ as R}from"./lodash.0a1ccad5.js";import"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import"./VPlaceholderSection.vue_vue&type=script&setup=true&lang.35b0ad2a.js";import"./VLoader.vue_vue&type=script&setup=true&lang.a96d7daf.js";import"./VFlexPagination.86ce707c.js";import"./search-4-dark.fb3880a5.js";import"./quiz.enum.fc8b95fc.js";f("data-v-06232136");const N={class:"popup-body"},T=w(" Add User ");b();var q=h({props:{modelValue:{type:Boolean,default:!1}},emits:["close","add"],setup(e,{emit:a}){const r=g(),{getPartnerUsers:s}=m(),t=()=>{a("close")},o=()=>{a("add",r.value)};return(a,n)=>{const l=u,c=i,d=p;return v(),y(d,{title:"Add User",open:e.modelValue,onClose:t},{content:P((()=>[U("div",N,[C(l,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=e=>r.value=e),searchable:!0,"label-by":"fullname","callback-search":j(s)},null,8,["modelValue","callback-search"])])])),action:P((()=>[C(c,{class:"ml-auto is-primary",onClick:o},{default:P((()=>[T])),_:1})])),_:1},8,["open"])}}});q.__scopeId="data-v-06232136";function z(){const{user:e}=l(),i=k({userList:[],isLoading:!0,total:0,isShowConFirmDeletePopup:!1,isShowAddUserPopup:!1,currentUser:void 0}),{currentPage:c,perPage:d,search:u}=H(),{getBatchUsers:p,createBatchUser:m,deleteBatchUser:f}=$(),b=_().params.id,h=x(),g=async()=>{i.isLoading=!0;const e=await p({batchId:+b,currentPage:c,perPage:d,search:u});e&&(i.userList=e.data,i.total=e.total),i.isLoading=!1},v=e=>{i.currentUser=e},y=()=>{v(),i.isShowConFirmDeletePopup=!1};D((async()=>{await g()}));return P=((e,a)=>{for(var r in a||(a={}))t.call(a,r)&&n(e,r,a[r]);if(s)for(var r of s(a))o.call(a,r)&&n(e,r,a[r]);return e})({},A(i)),a(P,r({batchId:b,userTableHeaders:[{key:"id",label:"ID"},{key:"fullname",label:"Name"},{key:"phone",label:"Phone"},{key:"email",label:"Email"}],changeCurrentUser:v,submitCreateBatchUser:async e=>{const a=await m({batchId:+b,partnerUserId:e});a.error?h.error(a.error.message):(h.success("Successfully added user"),await g(),i.isShowAddUserPopup=!1)},submitDeleteBatchUser:async()=>{if(!i.currentUser)return;const e=i.currentUser.id,a=await f({batchId:+b,partnerUserId:e});a.error?h.error(a.error.message):(h.success("Successfully deleted user"),await g(),y())},showConfirmDeletePopup:e=>{v(e),i.isShowConFirmDeletePopup=!0},closeConfirmDeletePopup:y,displaySummaryDetail:(e,a)=>{const r=e?`(${e.partnerName})`:"",s=a?`from ${a.name}`:"";return i.currentUser?`(ID:${i.currentUser.id}) ${i.currentUser.fullname} ${s} ${r}`:""},onLoginAsPartnerUser:a=>{if(i.isLoading=!0,e){const r=`https://www.globish.dev/Partner/Auth/System?partnerUserId=${a}&adminId=${19*e.id}`;window.location.assign(r)}R.delay((()=>{i.isLoading=!1}),15e3)}}));var P}f("data-v-5dfd9cee");const E=w("Add User"),G={key:0,class:"dark-inverted is-flex is-justify-content-flex-end"},M=w(" Actions "),Y=["onClick"],J=[U("div",{class:"icon"},[U("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:log-in"})],-1),U("div",{class:"meta"},[U("span",null,"Login as user"),U("span",null,"Login as Partner User (HR)")],-1)],K=["onClick"],Q=[U("div",{class:"icon"},[U("i",{"aria-hidden":"true",class:"lnil lnil-trash"})],-1),U("div",{class:"meta"},[U("span",null,"Delete"),U("span",null,"Delete Partner User (HR)")],-1)];b();var W=h({setup(e){const{batchId:a,userList:r,isLoading:s,userTableHeaders:t,total:o,isShowAddUserPopup:n,isShowConFirmDeletePopup:l,currentUser:u,submitCreateBatchUser:p,showConfirmDeletePopup:m,closeConfirmDeletePopup:f,submitDeleteBatchUser:b,displaySummaryDetail:h,onLoginAsPartnerUser:g}=z(),U=I("info"),w=I("batchInfo"),{users:k,usersHaveActionButton:_}=F();return(e,a)=>{const D=i,A=c,I=d,F=q,$=V,x=B;return v(),y(x,{title:"Partner Users",class:"partner-users-page"},L({default:P((()=>[C(I,{headers:j(t),data:j(r),"is-loading":j(s),total:j(o),"is-action":j(_)},{action:P((({value:e})=>[j(_)?(v(),S("div",G,[C(A,{spaced:"",right:""},{button:P((({toggle:e})=>[C(D,{icon:"feather:more-vertical",class:"is-trigger",onClick:e},{default:P((()=>[M])),_:2},1032,["onClick"])])),content:P((()=>[j(k).canLoginAsUser?(v(),S("a",{key:0,role:"menuitem",class:"dropdown-item is-media",onClick:a=>j(g)(e.id)},J,8,Y)):O("",!0),j(k).canDelete?(v(),S("a",{key:1,role:"menuitem",class:"dropdown-item is-media",onClick:a=>j(m)(e)},Q,8,K)):O("",!0)])),_:2},1024)])):O("",!0)])),_:1},8,["headers","data","is-loading","total","is-action"]),C(F,{"model-value":j(n),onClose:a[1]||(a[1]=e=>n.value=!1),onAdd:j(p)},null,8,["model-value","onAdd"]),j(u)?(v(),y($,{key:j(u).id,subtitle:j(h)(j(U),j(w)),open:j(l),onClose:j(f),onConfirm:j(b)},null,8,["subtitle","open","onClose","onConfirm"])):O("",!0)])),_:2},[j(k).canCreate?{name:"buttons",fn:P((()=>[C(D,{color:"primary",icon:"feather:plus",class:"btn",onClick:a[0]||(a[0]=e=>n.value=!0)},{default:P((()=>[E])),_:1})]))}:void 0]),1024)}}});W.__scopeId="data-v-5dfd9cee";export default W;
