var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,c=(s,a,i)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,o=(e,s)=>{for(var a in s||(s={}))t.call(s,a)&&c(e,a,s[a]);if(i)for(var a of i(s))l.call(s,a)&&c(e,a,s[a]);return e};import{e as d,p as n,c as r,j as u}from"./index.d7dc1ff6.js";import{_ as p}from"./SelectOption.vue_vue&type=script&setup=true&lang.934e0be4.js";import{_ as m,a as h}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as v}from"./FormTemplate.a6fb27bf.js";import{q as b,r as f,b as g,k as P,ad as y,ae as k,D as I,d as w,X as C,E as A,o as x,y as j,F as V,x as _,g as z,h as D,O as S,G as O,t as q,e as U,i as K,K as F,ai as T,I as Z,H as L,p as N,a as E}from"./vendor.1c8b4573.js";import{u as $}from"./useDiscountCodeApi.241c4e94.js";import{u as B}from"./useOptionApi.f4dc99b9.js";import{u as W}from"./useNotyf.ddf08f06.js";import{D as G}from"./discount-code.enum.6e9d29f6.js";import{P as H}from"./package.enum.de4ee89f.js";import{p as R,u as M,s as X,a as J}from"./useGuardSalesmanOrder.0724c123.js";import{u as Q}from"./useTextHelper.08cd3a6d.js";import"./quiz.enum.fc8b95fc.js";import"./csv.helper.d14e8c45.js";import"./student.helper.13430dac.js";import"./student.enum.ad6af513.js";const Y={studentId:void 0,packageIds:[],couponId:void 0,wht:0,instances:[0,0],address:{no:"",district:"",subDistrict:"",province:"",zipcode:"",phone:""},isLoading:!1,couponCode:"",discountPrice:0,totalPrice:0,zipcodeAddress:"",whtPrice:0};function ee(){const e=b(o({},Y)),i=f(R.data),{checkPackagesDiscountPrice:t,postCreateOrderInstance:l}=M(),c=g(),n=W(),r=P((()=>e.instances.reduce(((e,s,a)=>Number((e+ +s).toFixed(2))),0))),u=P((()=>Number((e.totalPrice-e.discountPrice-e.whtPrice).toFixed(2)))),p=P((()=>0===e.totalPrice||u.value!==r.value)),m=P((()=>0!==e.totalPrice&&u.value!==r.value)),h=P((()=>0!==e.totalPrice&&u.value-r.value<0)),v=P((()=>0!==e.totalPrice&&u.value-r.value>0)),{getPackages:w,getStudents:C}=B(),{getAllDiscountCode:A}=$(),x=()=>{e.couponId=void 0,e.couponCode="",e.discountPrice=0,j()};y((()=>{e.studentId=void 0,e.packageIds=[],e.couponId=void 0,e.wht=0,e.instances=[0,0],e.address={no:"",district:"",subDistrict:"",province:"",zipcode:"",phone:""},e.isLoading=!1,e.couponCode="",e.discountPrice=0,e.totalPrice=0,e.zipcodeAddress="",e.whtPrice=0}));const j=async()=>{if(e.wht&&e.wht>3&&(e.wht=3),!e.packageIds.length)return;const{data:s,code:a,message:i}=await t({packageIds:e.packageIds,couponId:e.couponId?e.couponId:void 0,wht:e.wht?e.wht:void 0});s&&s.totalPrice>=s.discountPrice?(e.discountPrice=s.discountPrice,e.totalPrice=s.totalPrice,e.whtPrice=s.whtPrice):(n.error(406===a?i:"Please try again"),e.discountPrice=0,e.couponId=void 0,j())},V=()=>{e.packageIds=[],e.totalPrice=0,e.discountPrice=0,e.whtPrice=0,j()};return _=o({},k(e)),s(_,a({createOrder:async()=>{if(e.instances.filter((e=>0===e)).length>0)return void n.error("Please fill the instance number");if(0===e.packageIds.length)return void n.error("Please Select Package");e.isLoading=!0;const s={no:e.address.no&&""!==e.address.no?e.address.no:void 0,district:e.address.district&&""!==e.address.district?e.address.district:void 0,subDistrict:e.address.subDistrict&&""!==e.address.subDistrict?e.address.subDistrict:void 0,province:e.address.province&&""!==e.address.province?e.address.province:void 0,zipcode:e.address.zipcode&&""!==e.address.zipcode?e.address.zipcode:void 0,phone:e.address.phone&&""!==e.address.phone?e.address.phone:void 0},{status:a,message:i}=await l({studentId:e.studentId,packageIds:e.packageIds,couponId:e.couponId,instances:e.instances,address:s,wht:e.wht&&0!==e.wht?e.wht:void 0});e.isLoading=!1,201===a?(n.success("Create Order Success!"),c.push({name:"salesman-orders"})):n.error(d(i)||"Fail")},incInstance:s=>{e.instances.push(0)},decInstance:s=>{s>-1&&e.instances.splice(s,1)},totalInstance:r,fetchCoupon:async s=>{const a=await A({search:s,currentPage:1,perPage:500}),i=null==a?void 0:a.data.filter((e=>{const s=I().isSameOrAfter(I(e.expireDate).add(1,"d"),"day"),a=e.usedCoupons<e.availableCoupons;return!s&&a}));return e.couponId&&!(null==i?void 0:i.find((s=>s.id===e.couponId)))&&x(),i||[]},clearCoupon:x,changeCoupon:(s,a)=>{e.couponId=s,e.couponCode=a.code,j(),e.discountPrice=a.discountType===G.PERCENTAGE?e.totalPrice*a.discount/100:a.discount},fetchPackage:e=>w(e,{purchasable:H.SALE}),changePackage:(s,a)=>{a.price&&(e.totalPrice+=parseFloat(a.price)),j()},deselectPackage:(s,a)=>{a.price&&(e.totalPrice-=parseFloat(a.price)),e.packageIds.length?j():V()},clearPackage:V,getStudents:C,searchByZipcode:async e=>(await X(e||"")).map((e=>({district:null==e?void 0:e.district,amphoe:null==e?void 0:e.amphoe,province:null==e?void 0:e.province,zipcode:null==e?void 0:e.zipcode,value:`${e.district} - ${e.amphoe} - ${e.province} - ${e.zipcode}`})))||[],selectZipcode:(s,a)=>{const{amphoe:i,district:t,province:l,zipcode:c}=a;e.address.zipcode=c,e.address.district=i,e.address.subDistrict=t,e.address.province=l},provinceList:i,netPrice:u,checkDiscountPrice:j,clearStudent:()=>{e.studentId=void 0},clearZipcode:()=>{e.address.zipcode=void 0},disabledBtn:p,greaterValue:h,lowerValue:v,showAddInstances:m}));var _}N("data-v-c4497f18");const se=O("Submit"),ae={class:"columns is-multiline"},ie={class:"column is-12"},te=D("label",null,"Student",-1),le={class:"column is-12"},ce=D("label",null,[O("Packages "),D("span",{class:"red"},"*")],-1),oe={class:"multiselect-tag"},de=["onClick"],ne=[D("span",{class:"multiselect-tag-remove-icon"},null,-1)],re={class:"select-option-text"},ue={class:"column is-12"},pe=D("label",null,"Coupon",-1),me={class:"column is-12"},he=D("label",null,"Withholding Tax Price",-1),ve=D("div",{class:"column is-3"},null,-1),be={class:"column py-3 is-half"},fe={class:"is-flex is-justify-content-space-between m-2"},ge=D("h3",{class:"title is-5 m-0"},"Total Price",-1),Pe={class:"subtitle is-5 m-0"},ye={key:0,class:"is-flex is-justify-content-space-between m-2"},ke=D("h3",{class:"title is-5 m-0"},"Discount Price",-1),Ie={class:"subtitle is-5 has-text-danger m-0"},we={key:1,class:"is-flex is-justify-content-space-between m-2"},Ce=D("h3",{class:"title is-5 m-0"},"Withholding Tax Price",-1),Ae={class:"subtitle is-5 has-text-secondary m-0"},xe=D("div",{class:"is-divider my-2"},null,-1),je={class:"is-flex is-justify-content-space-between m-2"},Ve=D("h3",{class:"title is-5 m-0"},"Paid Price",-1),_e={class:"subtitle is-5 has-text-success m-0"},ze=D("div",{class:"column is-3"},null,-1),De={class:"column is-2 text-instances"},Se={class:"column is-9"},Oe={key:0},qe=[D("p",null,[O("แบ่งชำระ "),D("span",{class:"red"},"*")],-1)],Ue=["onUpdate:modelValue","disabled"],Ke={class:"btn-container"},Fe={class:"column is-4 is-flex is-align-items-center is-justify-content-flex-end text-total-instance"},Te={class:"subtitle"},Ze={class:"column is-4 is-flex is-align-items-center is-justify-content-center text-total-instance"},Le={key:0,class:"subtitle has-text-danger"},Ne={key:1,class:"subtitle has-text-info"},Ee={key:0,class:"column is-4 btn-plus"},$e=O("Add Instances"),Be=["onUpdate:modelValue","placeholder"];E();var We=w({setup(e){const{studentId:s,packageIds:a,couponId:i,instances:t,address:l,wht:c,isLoading:o,totalPrice:d,zipcodeAddress:b,provinceList:f,discountPrice:g,whtPrice:P,createOrder:y,incInstance:k,decInstance:I,totalInstance:w,netPrice:N,disabledBtn:E,greaterValue:$,lowerValue:B,showAddInstances:W,fetchCoupon:G,changeCoupon:H,clearCoupon:R,fetchPackage:M,changePackage:X,deselectPackage:Y,clearPackage:We,getStudents:Ge,clearStudent:He,selectZipcode:Re,searchByZipcode:Me,clearZipcode:Xe,checkDiscountPrice:Je}=ee(),{displayPackageName:Qe}=Q();n.value="Create Order Instance",C({title:"Whitehouse: Create Order Instance"}),J();const Ye=e=>e.toLocaleString("en-US",{minimumFractionDigits:2}),es=[{label:"Number",icon:"lnil lnil-home",editAddressKey:"no",placeholder:"Address Number",required:"Address number is required."},{label:"Zipcode",icon:"lnir lnir-zip",editAddressKey:"zipcode",placeholder:"Address Zipcode",required:"Address zipcode is required."},{label:"Province",icon:"lnil lnil-bridge",editAddressKey:"province",placeholder:"Address Province",required:"Address province is required."},{label:"Subdistrict",icon:"lnil lnil-apartment-alt",editAddressKey:"subDistrict",placeholder:"Address Subdistrict",required:"Address subdistrict is required."},{label:"District",icon:"lnil lnil-apartment",editAddressKey:"district",placeholder:"Address District",required:"Address district is required."},{label:"Phone",icon:"lnil lnil-phone",editAddressKey:"phone",placeholder:"Phone Number",required:"Address district is required."}];return(e,n)=>{const C=r,J=p,Q=m,ee=h,ss=A("Multiselect"),as=m,is=h,ts=u,ls=v;return x(),j(ls,{title:"Create Order Instance"},{buttons:V((()=>[_(C,{color:"primary",icon:"lnir lnir-checkmark rem-100",loading:z(o),disabled:z(E),raised:"",onClick:z(y)},{default:V((()=>[se])),_:1},8,["loading","disabled","onClick"])])),default:V((()=>[D("div",ae,[D("div",ie,[_(ee,null,{default:V((()=>[te,_(Q,null,{default:V((()=>[_(J,{modelValue:z(s),"onUpdate:modelValue":n[0]||(n[0]=e=>S(s)?s.value=e:null),"callback-search":z(Ge),"label-by":"fullnameTh","more-label-by":"fullnameEn","close-on-select":!1,"clear-on-search":!1,"value-prop":"id",placeholder:"Select student for send package (Search by name)",onClear:z(He)},null,8,["modelValue","callback-search","onClear"])])),_:1})])),_:1})]),D("div",le,[_(is,null,{default:V((()=>[ce,_(as,null,{default:V((()=>[_(ss,{modelValue:z(a),"onUpdate:modelValue":n[1]||(n[1]=e=>S(a)?a.value=e:null),mode:"tags",filterResults:!1,delay:0,searchable:!0,"create-tag":!1,options:z(M),"tag-by":"id","value-prop":"id",placeholder:"Select package",onSelect:z(X),onDeselect:z(Y),onClear:z(We)},{tag:V((({option:e,handleTagRemove:s,disabled:a})=>[D("div",oe,[O(q(z(Qe)(e,{showPrice:!0}))+" ",1),a?K("",!0):(x(),U("span",{key:0,class:"multiselect-tag-remove",onClick:a=>s(e,a)},ne,8,de))])])),option:V((({option:e})=>[D("span",re,q(z(Qe)(e,{showPrice:!0})),1)])),_:1},8,["modelValue","options","onSelect","onDeselect","onClear"])])),_:1})])),_:1})]),D("div",ue,[_(is,null,{default:V((()=>[pe,_(as,null,{default:V((()=>[_(J,{key:z(a).join(),modelValue:z(i),"onUpdate:modelValue":[n[2]||(n[2]=e=>S(i)?i.value=e:null),z(H)],placeholder:"search by id, code, expire date, packages name packages id","label-by":"code","callback-search":z(G),onClear:z(R)},null,8,["modelValue","callback-search","onUpdate:modelValue","onClear"])])),_:1})])),_:1})]),D("div",me,[_(is,null,{default:V((()=>[he,_(as,null,{default:V((()=>[F(D("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>S(c)?c.value=e:null),class:"input is-primary-focus",type:"number",min:"0",max:"3",placeholder:"Withholding Tax",onInput:n[4]||(n[4]=(...e)=>z(Je)&&z(Je)(...e))},null,544),[[T,z(c)]])])),_:1})])),_:1})]),ve,D("div",be,[D("div",fe,[ge,D("p",Pe,q(Ye(z(d))),1)]),z(g)?(x(),U("div",ye,[ke,D("p",Ie,q(z(g)?`-${Ye(z(g))}`:0),1)])):K("",!0),z(P)?(x(),U("div",we,[Ce,D("p",Ae,q(z(P)?`-${Ye(z(P))}`:0),1)])):K("",!0),xe,D("div",je,[Ve,D("p",_e,q(Ye(z(N))),1)])]),ze,(x(!0),U(L,null,Z(z(t),((e,s)=>(x(),U("span",{key:s,class:"instance-container is-flex is-align-items-flex-end columns"},[D("div",De,[D("p",null,"งวดที่ "+q(s+1)+" :",1)]),D("div",Se,[_(ee,null,{default:V((()=>[0===s?(x(),U("label",Oe,qe)):K("",!0),_(Q,{class:"input-instance"},{default:V((()=>[F(D("input",{"onUpdate:modelValue":e=>z(t)[s]=e,type:"number",class:"input is-primary-focus input-option",placeholder:"Fill Number Here",disabled:z(o),min:"0",step:"1"},null,8,Ue),[[T,z(t)[s]]]),D("div",Ke,[z(t).length>2?(x(),j(ts,{key:0,icon:"lnir lnir-trash-can",class:"button is-secondary has-text-danger",onClick:e=>z(I)(s)},null,8,["onClick"])):K("",!0)])])),_:2},1024)])),_:2},1024)])])))),128)),D("div",Fe,[D("p",Te,"ผ่อนทั้งหมด: "+q(Ye(z(w))),1)]),D("div",Ze,[z(B)?(x(),U("p",Le," ขาดอีก: "+q(Ye(z(N)-z(w))),1)):z($)?(x(),U("p",Ne," ชำระเกิน: "+q(Ye(z(N)-z(w)).substring(1)),1)):K("",!0)]),z(W)?(x(),U("div",Ee,[_(C,{color:"primary",class:"btn-plus",onClick:z(k)},{default:V((()=>[$e])),_:1},8,["onClick"])])):K("",!0),(x(),U(L,null,Z(es,((e,s)=>D("div",{key:s,class:"column is-12"},[_(ee,null,{default:V((()=>[D("label",null,q(e.label),1),"Zipcode"===e.label?(x(),j(Q,{key:0,icon:e.icon,class:"province-option"},{default:V((()=>[_(J,{modelValue:z(b),"onUpdate:modelValue":[n[5]||(n[5]=e=>S(b)?b.value=e:null),z(Re)],"value-prop":"value","track-by":"zipcode","label-by":"zipcode",class:"province-option is-primary-focus","callback-search":z(Me),"no-options-text":"พิมพ์รหัสไปรษณีย์ เพื่อเลือกที่อยู่ของนักเรียน","search-value":z(l).zipcode,placeholder:"Address Zipcode",onClear:z(Xe)},{option:V((e=>[O(q(e.option.district)+" - "+q(e.option.amphoe)+" - "+q(e.option.province)+" - "+q(e.option.zipcode),1)])),_:1},8,["modelValue","callback-search","search-value","onUpdate:modelValue","onClear"])])),_:2},1032,["icon"])):"Province"===e.label?(x(),j(Q,{key:1,icon:e.icon,class:"province-option"},{default:V((()=>[_(ss,{modelValue:z(l)[e.editAddressKey],"onUpdate:modelValue":s=>z(l)[e.editAddressKey]=s,name:"province",options:z(f),class:"is-primary-focus input-option",placeholder:"Address Province"},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["icon"])):(x(),j(Q,{key:2,icon:e.icon},{default:V((()=>[F(D("input",{"onUpdate:modelValue":s=>z(l)[e.editAddressKey]=s,type:"text",class:"input is-primary-focus input-option",placeholder:e.placeholder},null,8,Be),[[T,z(l)[e.editAddressKey]]])])),_:2},1032,["icon"]))])),_:2},1024)]))),64))])])),_:1})}}});We.__scopeId="data-v-c4497f18";export default We;
