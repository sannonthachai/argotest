var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,i=(e,a)=>{for(var s in a||(a={}))l.call(a,s)&&o(e,s,a[s]);if(t)for(var s of t(a))n.call(a,s)&&o(e,s,a[s]);return e},r=(e,t)=>a(e,s(t));import{_ as u,a as c}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as p}from"./SelectOption.vue_vue&type=script&setup=true&lang.934e0be4.js";import{e as m,p as d,c as f}from"./index.d7dc1ff6.js";import{_ as g}from"./VButtons.vue_vue&type=script&setup=true&lang.18e95460.js";import{_ as b}from"./VIconBox.vue_vue&type=script&setup=true&lang.7bffdb35.js";import{_ as h}from"./VTag.vue_vue&type=script&setup=true&lang.b31af8ee.js";import{_ as v}from"./VTags.vue_vue&type=script&setup=true&lang.156e160d.js";import{_ as y}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{_}from"./FlexListPermission.2b0135fd.js";import{b as O,q as j,k as w,Y as I,ae as x,N as C,d as M,X as k,o as V,e as R,h as P,x as N,F as D,K as T,ai as B,g as L,O as q,V as A,H as F,I as S,t as U,G as z,y as E,i as G,p as H,a as K}from"./vendor.1c8b4573.js";import{u as W}from"./useOptionApi.f4dc99b9.js";import{u as X}from"./usePermissionApi.9e405600.js";import"./VMessage.vue_vue&type=script&setup=true&lang.1bdbe413.js";import"./VBlock.vue_vue&type=script&setup=true&lang.2e664adb.js";import"./quiz.enum.fc8b95fc.js";const Y=new C({duration:2e3,position:{x:"center",y:"top"}});H("data-v-b6fdffa2");const J={class:"box-container"},Q={class:"box-permission"},Z=P("div",{class:"py-4"},[P("h3",{class:"text-header"},"Create Role")],-1),$=P("label",null,"Role name",-1),ee={class:"help has-text-danger"},ae=P("label",null,"Role description",-1),se={class:"help has-text-danger"},te=P("label",null,"Team",-1),le={class:"help has-text-danger"},ne={class:"align-button mt-4 py-4"},oe=z(" Clear "),ie=z(" Create "),re={key:0},ue=["data-icon"],ce={class:"flex-meta"},pe=P("i",{class:"fas fa-list"},null,-1),me=P("i",{class:"lnir lnir-bookmark"},null,-1),de={class:"pb-1"};K();var fe=M({setup(e){d.value="Create Role",k({title:"Whitehouse Create Role"});const{menuItems:a,roleName:s,roleDescription:t,menuLoading:l,loadingOption:n,teamOptions:o,teamId:C,showMessage:M,colorMessage:H,verifyMessage:K,selectedItems:fe,disabledCreateBtn:ge,fetchTeamsOption:be,onCreate:he,onClear:ve}=function(){const{createRole:e,getMenus:a}=X(),{getTeams:s}=W(),t=O(),l=j({menuItems:[],roleName:"",roleDescription:"",teamId:void 0,teamOptions:[],menuLoading:!1,loadingOption:!1,showMessage:!0}),n=w((()=>l.roleDescription.trim().length<12||l.roleName.trim().length<4||0===o.value.length||!l.teamId)),o=w((()=>l.menuItems.reduce(((e,a)=>{let s=0;const t=a.subMenus.filter((({actions:e})=>{const a=(e||[]).filter((e=>e.selected));return(null==a?void 0:a.length)>0&&(s+=a.length,!0)}));return(null==t?void 0:t.length)>0&&e.push({name:a.name,icon:"feather:file-plus",actions:s,subtitles:null==t?void 0:t.length,subMenus:t.map((({name:e,actions:a})=>({name:e,actions:(a||[]).filter((({selected:e})=>e)).map((e=>({id:e.id,name:e.actionName})))})))}),e}),[]))),u=w((()=>(0===o.value.length&&(l.showMessage=!0),l.showMessage))),c=w((()=>0===o.value.length?"danger":"success")),p=async()=>{l.menuLoading=!0;const e=await a();l.menuItems=e.map((e=>{let a=0;const s=e.subMenus.map((e=>{const s=e.permissions.map((e=>r(i({},e),{selected:!1})));return a+=s.length,r(i({},e),{actions:s})}));return r(i({},e),{show:!1,subtitles:s.length,actions:a,icon:"feather:file-plus",subMenus:s})})),l.menuLoading=!1},d=async e=>(l.loadingOption=!0,l.teamOptions=await s({currentPage:1,perPage:25,search:e}),l.loadingOption=!1,l.teamOptions);return I((()=>{p(),d()})),r(i({},x(l)),{disabledCreateBtn:n,selectedItems:o,verifyMessage:u,colorMessage:c,fetchTeamsOption:d,onCreate:async()=>{const a=o.value.map((e=>e.subMenus.map((e=>e.actions.map((e=>e.id)))))).flat(2);if(null==l?void 0:l.teamId){const{status:s,message:n,data:o}=await e({description:l.roleDescription,teamId:l.teamId,name:l.roleName,permissionIds:a});201===s?(Y.open({type:"success",message:"Role was created!"}),t.push({name:"permissions-roles-:id",params:{id:(null==o?void 0:o.id)||""}})):Y.open({message:m(n),type:"error"})}},onClear:async()=>{l.roleDescription="",l.roleName="",l.teamId=void 0,await p()}})}();return(e,o)=>{const i=u,r=c,m=p,d=f,O=g,j=b,w=h,I=v,x=y,M=_;return V(),R("div",J,[P("div",Q,[N(x,null,{default:D((()=>[Z,P("div",null,[N(r,null,{default:D((()=>[$,N(i,{icon:"lnil lnil-protection"},{default:D((()=>[T(P("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>q(s)?s.value=e:null),type:"text",class:"input",placeholder:"Role name"},null,512),[[B,L(s)]])])),_:1}),T(P("p",ee," Role name required atleast 4 characters. ",512),[[A,L(s).trim().length<4]])])),_:1}),N(r,null,{default:D((()=>[ae,N(i,null,{default:D((()=>[T(P("textarea",{"onUpdate:modelValue":o[1]||(o[1]=e=>q(t)?t.value=e:null),class:"textarea",rows:"3",placeholder:"A description for this role..."},null,512),[[B,L(t)]])])),_:1}),T(P("p",se," Role description required atleast 12 characters. ",512),[[A,L(t).trim().length<12]])])),_:1}),N(r,{class:"is-autocomplete-select"},{default:D((()=>[te,N(i,{icon:"feather:search",loading:L(n)},{default:D((()=>[N(m,{modelValue:L(C),"onUpdate:modelValue":o[2]||(o[2]=e=>q(C)?C.value=e:null),"callback-search":L(be),"tract-by":"name","value-prop":"id",placeholder:"Select team"},null,8,["modelValue","callback-search"]),T(P("p",le," Choose team for this role. ",512),[[A,!L(C)]])])),_:1},8,["loading"])])),_:1})]),P("div",ne,[N(O,null,{default:D((()=>[N(d,{loading:L(l),onClick:L(ve)},{default:D((()=>[oe])),_:1},8,["loading","onClick"]),N(d,{color:"primary",disabled:L(ge),onClick:L(he)},{default:D((()=>[ie])),_:1},8,["disabled","onClick"])])),_:1})]),L(fe).length>0?(V(),R("div",re,[(V(!0),R(F,null,S(L(fe),((e,a)=>(V(),R("div",{key:a,class:"media-flex"},[N(j,{key:e.icon,size:"small",color:"primary"},{default:D((()=>[P("i",{class:"iconify","data-icon":e.icon},null,8,ue)])),_:2},1024),P("div",ce,[P("span",null,U(e.name),1),P("span",null,[pe,z(" "+U(e.subtitles)+" subtitles ",1),me,z(" "+U(e.actions)+" actions",1)]),(V(!0),R(F,null,S(e.subMenus,((e,a)=>(V(),R("div",{key:a,class:"pt-2"},[P("h3",de,U(e.name),1),N(I,{class:"mb-1"},{default:D((()=>[(V(!0),R(F,null,S(e.actions,((e,a)=>(V(),E(w,{key:a,label:e.name.replace(/_/g," ")},null,8,["label"])))),128))])),_:2},1024)])))),128))])])))),128))])):G("",!0)])),_:1})]),N(M,{items:L(a),"show-message":L(K),"color-message":L(H)},null,8,["items","show-message","color-message"])])}}});fe.__scopeId="data-v-b6fdffa2";export default fe;
