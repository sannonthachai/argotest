var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;import{_ as r,a as c}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{p as n,j as d}from"./index.d7dc1ff6.js";import{_ as u}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{_ as f}from"./VLoader.vue_vue&type=script&setup=true&lang.a96d7daf.js";import{_ as h}from"./VPlaceholderPage.vue_vue&type=script&setup=true&lang.e3e86478.js";import{_ as p,a as m}from"./search-4-dark.fb3880a5.js";import{A as g,b,q as v,ae as y,D as S,d as k,X as I,E as j,g as _,o as C,e as D,x,F as O,h as L,ao as w,ap as V,O as Y,G as A,t as z,i as F,H as T,I as P,y as E,p as M,a as $}from"./vendor.1c8b4573.js";import{u as N}from"./useGuardCoach.2473a459.js";import{b as B}from"./coach.enum.0ff8980c.js";import{u as R}from"./useCoachApi.4bab1366.js";import{u as q}from"./useNotyf.ddf08f06.js";import{b as G,c as U}from"./date.helper.6ae3fc87.js";import{a as H}from"./coach.helper.9bed4f65.js";import{u as K}from"./useOptionApi.f4dc99b9.js";import"./index.ec15dc7d.js";import"./lodash.0a1ccad5.js";import"./quiz.enum.fc8b95fc.js";const W=["00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30","04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"];function X(){g(),b();const{getCoachSlots:e}=R(),r=q(),c=v({isLoading:!1,isLoadingFilterDate:!1,coachIds:[],filter:{search:"",range:{start:void 0,end:void 0}},coachSlots:[],coachesSelected:[]}),n=(e,a)=>{e.map((e=>{const t=Array(48).fill(0),s=Array(48).fill(0);e.slots.forEach((e=>{t[W.findIndex((a=>a===e.slotTime))]=e.availableSlot})),e.slots.forEach((e=>{s[W.findIndex((a=>a===e.slotTime))]=e.bookedSlot}));const o={colors:["#47e396","#f54660"],chart:{id:e.coachId,group:"coachSlot",type:"bar",stacked:!0},plotOptions:{bar:{horizontal:!1,dataLabels:{position:"top"},borderRadius:5}},tooltip:{enabled:!0,x:{show:!0,formatter:function(e){return e}}},legend:{position:"right"},dataLabels:{offsetY:-20,enabled:!0,style:{colors:["#fff,#373D3F"]},formatter:function(e,{seriesIndex:a,dataPointIndex:t,w:s}){const o=s.config.series.length-1;if(a==o)return s.globals.stackedSeriesTotals[t];if(a<o){let e=0;for(;a<o;)a++,e+=s.config.series[a].data[t]||0;if(0===e)return s.globals.stackedSeriesTotals[t]}}},xaxis:{categories:W,labels:{rotate:-45}},yaxis:[{tickAmount:1,labels:{formatter:function(e){return e.toFixed(0)}}}]};o.tooltip.x.formatter=function(a){const t=e.coach.timezone;if("Asia/Bangkok"===e.coach.timezone)return`${a} (${G(t)})`;{const e={hour:+a.substring(0,2),minute:+a.substring(3,5)};return`${a} (${U(t,e)} ${G(t)})`}};const l={coachId:e.coachId,coachName:e.coach.nickname||e.coach.fullname,timezone:e.coach.timezone,series:[{data:t,name:B.AVAILABLE},{data:s,name:B.BOOKED}],chartOptions:o},i=a.findIndex((e=>e.coachId===l.coachId));-1===i?c.coachSlots.push(l):c.coachSlots[i]=l}))};return d=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&i(e,t,a[t]);if(s)for(var t of s(a))l.call(a,t)&&i(e,t,a[t]);return e})({},y(c)),a(d,t({clearCoaches:()=>{c.coachIds=[],c.coachSlots=[]},removeCoachSlots:e=>{c.coachSlots.splice(c.coachSlots.findIndex((a=>a.coachId===e.id)),1)},handleCoachSlots:async(a,t)=>{if(c.coachIds.length>6||c.coachSlots.length>5)c.coachIds=c.coachIds.filter((e=>e!==t.id)),r.error("The limit is 6 chart");else if(t&&c.filter.range.start&&c.filter.range.end){c.isLoading=!0;const a={coachIds:t.id.toString(),startDate:c.filter.range.start,endDate:c.filter.range.end},s=await e(a);s&&n(s,c.coachSlots),c.isLoading=!1}},handleFilterDate:async()=>{if(S(c.filter.range.end).diff(c.filter.range.start,"days")>14)return r.error("Cannot filter date more than 14 days");if(0===c.coachIds.length)return r.error("Please select some coach");if(c.coachSlots.length>6)return r.error("The limit is 6 chart");if(c.filter.range.start&&c.filter.range.end){c.isLoading=!0;const a={coachIds:c.coachIds.toString(),startDate:c.filter.range.start,endDate:c.filter.range.end},t=await e(a);c.isLoadingFilterDate=!0,t&&n(t,c.coachSlots),await H(50),c.isLoading=!1,c.isLoadingFilterDate=!1}},coachTz:e=>`${G(e)} (${e})`}));var d}M("data-v-2125fb81");const J={key:0},Q={class:"custom-filter"},Z={class:"columns is-multiline"},ee={class:"column is-5"},ae=L("label",{class:"label-date"},"Date range",-1),te=["value","disabled"],se=["value","disabled"],oe={class:"column is-8"},le=L("label",null,"Coaches",-1),ie={class:"multiselect-tag"},re=["onClick"],ce=[L("span",{class:"multiselect-tag-remove-icon"},null,-1)],ne={class:"select-option-text"},de={key:0},ue={class:"apex-header"},fe={class:"subtitle"},he={key:1},pe=L("img",{class:"light-image",src:p,alt:""},null,-1),me=L("img",{class:"dark-image",src:m,alt:""},null,-1);$();var ge=k({setup(e){n.value="Coaches Slots",I({title:"Whitehouse: Coaches Slots"});const{getCoaches:a}=K(),{isLoading:t,isLoadingFilterDate:s,coachIds:o,coachSlots:l,clearCoaches:i,removeCoachSlots:p,handleCoachSlots:m,handleFilterDate:g,filter:b,coachTz:v}=X(),{capabilities:y}=N();return(e,n)=>{const S=r,k=d,I=c,M=j("v-date-picker"),$=j("Multiselect"),N=r,B=c,R=u,q=j("apexchart"),G=f,U=h;return _(y).canViewListOfCoachSlot?(C(),D("div",J,[x(R,null,{default:O((()=>[L("div",Q,[L("div",Z,[L("div",ee,[x(M,{modelValue:_(b).range,"onUpdate:modelValue":n[0]||(n[0]=e=>_(b).range=e),"is-range":"",color:"orange","trim-weeks":"","model-config":{start:{type:"string",mask:"YYYY-MM-DD",timeAdjust:"00:00:00"},end:{type:"string",mask:"YYYY-MM-DD",timeAdjust:"00:00:00"}},masks:{input:"DD/MM/YYYY"},popover:{visibility:"click"}},{default:O((({inputValue:e,inputEvents:a})=>[ae,x(I,{addons:""},{default:O((()=>[x(S,null,{default:O((()=>[L("input",w({value:e.start,class:"input",disabled:_(t)},V(a.start)),null,16,te)])),_:2},1024),x(S,null,{default:O((()=>[x(k,{icon:"feather:arrow-right",class:"is-static"})])),_:1}),x(S,null,{default:O((()=>[L("input",w({value:e.end,class:"input",disabled:_(t)},V(a.end)),null,16,se)])),_:2},1024),x(S,null,{default:O((()=>[x(k,{color:"warning",icon:"feather:search",outlined:"",disabled:_(t),onClick:_(g)},null,8,["disabled","onClick"])])),_:1})])),_:2},1024)])),_:1},8,["modelValue"])]),L("div",oe,[x(B,null,{default:O((()=>[le,x(N,null,{default:O((()=>[x($,{modelValue:_(o),"onUpdate:modelValue":n[1]||(n[1]=e=>Y(o)?o.value=e:null),mode:"tags",disabled:_(t),filterResults:!1,delay:0,searchable:!0,"create-tag":!1,options:_(a),"tag-by":"id","value-prop":"id",placeholder:"Select coaches",onClear:_(i),onSelect:_(m)},{tag:O((({option:e,handleTagRemove:a,disabled:t})=>[L("div",ie,[A(" ("+z(e.id)+") "+z(e.nickname||e.fullname)+" ",1),t?F("",!0):(C(),D("span",{key:0,class:"multiselect-tag-remove",onClick:t=>(a(e,t),_(p)(e))},ce,8,re))])])),option:O((({option:e})=>[L("span",ne," ("+z(e.id)+") "+z(e.nickname||e.fullname),1)])),_:1},8,["modelValue","disabled","options","onClear","onSelect"])])),_:1})])),_:1})])])])])),_:1}),_(l).length>0?(C(),D("div",de,[L("div",null,[x(G,{size:"large",translucent:"",active:_(t)||_(s)},{default:O((()=>[_(s)?F("",!0):(C(!0),D(T,{key:0},P(_(l),(e=>(C(),E(R,{key:e.coachId},{default:O((()=>[L("div",ue,[L("h4",fe,z(e.coachName),1),L("p",null,z(_(v)(e.timezone)),1)]),x(q,{key:e.coachId,height:"250px",options:e.chartOptions,series:e.series},null,8,["options","series"])])),_:2},1024)))),128))])),_:1},8,["active"])])])):(C(),D("div",he,[x(R,{class:"no-data"},{default:O((()=>[x(U,{title:"No data to show",subtitle:"There is currently no data to show in this list.",larger:""},{image:O((()=>[pe,me])),_:1})])),_:1})]))])):F("",!0)}}});ge.__scopeId="data-v-2125fb81";export default ge;
