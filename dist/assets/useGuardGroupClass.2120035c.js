var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))i.call(t,a)&&r(e,a,t[a]);return e},d=(e,s)=>t(e,a(s));import{b as p,A as u,q as l,D as c,Y as C,S,k as v,ae as m}from"./vendor.1c8b4573.js";import{g as y,h as f,i as g,d as I,j as A}from"./classroom.enum.d4d52ed5.js";import{t as R}from"./date.helper.6ae3fc87.js";import{u as G}from"./usePaginationRoute.780ca235.js";import{u as T}from"./useClassroomApi.cba9f1f2.js";import{o as L,u as h}from"./index.d7dc1ff6.js";function D(){const e=p(),t=u(),{currentPage:a,perPage:s}=G(),{getGroupClasses:o,getGroupClassStudent:i,deleteGroupClass:r,uploadGroupClassCsv:h,createGroupClassReport:D,getGroupClassReportById:E,updateGroupClassReport:_,updateGroupClassAttend:w}=T(),O=l({totalGroupClasses:0,groupClasses:[],isLoading:!1,viewBySpecificTime:!1,dateSearch:!1,filter:{groupClassType:void 0,datetime:void 0,search:"",range:{},country:void 0},openGroupClassStudent:!1,openGroupClassReport:!1,readonlyGroupClassReport:!1,groupClassInfo:{id:void 0,topic:"",description:void 0,descriptionEn:void 0,descriptionTh:void 0,descriptionVn:void 0,coachId:void 0,time:"",type:void 0,duration:void 0,accessLimit:void 0,hostId:void 0,service:void 0,level:void 0,link:void 0,studentGroup:void 0,campaign:void 0,curriculumId:void 0,status:void 0,groupClassReport:void 0},groupClassReportInfo:{groupClassId:void 0,type:y.CANCEL,reason:f.ACCEPTABLE,problemDetail:"",note:"",returnTicket:g.NO},groupClassStudentInfo:{topic:"",level:void 0,coach:{id:0,nickname:"",fullname:""},type:void 0,datetime:void 0,duration:0,accessLimit:0,shareLimit:0,studentBooks:[],studentAttends:[]},isDeleting:!1,uploading:!1,openAttend:!1,attend:{dateTime:"",isLoadingAttend:!1,id:0,studentId:void 0,time:c().format(),type:"",name:void 0,topic:""}}),b=async()=>{O.isLoading=!0;const e=t.query.startDate,i=t.query.endDate;t.query.datetime?(O.filter.datetime=new Date(t.query.datetime),O.viewBySpecificTime=!0):e&&i&&(O.filter.range={start:new Date(c(e,"YYYY-MM-DD").startOf("day").toISOString()),end:new Date(c(i,"YYYY-MM-DD").endOf("day").toISOString())});const r={currentPage:a,perPage:s,datetime:O.viewBySpecificTime&&O.dateSearch?c(O.filter.datetime).toISOString():void 0,startDate:!O.viewBySpecificTime&&O.dateSearch?c(O.filter.range.start).toISOString():void 0,endDate:!O.viewBySpecificTime&&O.dateSearch?c(O.filter.range.end).toISOString():void 0,type:O.filter.groupClassType||void 0,search:O.filter.search,country:O.filter.country||void 0},n=await o(r);O.isLoading=!1,n&&(O.totalGroupClasses=n.total,O.groupClasses=n.data)},P=()=>{e.push({name:"classrooms-group-classes",params:t.params,query:d(n({},t.query),{viewBySpecificTime:O.viewBySpecificTime?"true":"false",dateSearch:O.dateSearch?"true":"false",datetime:O.viewBySpecificTime&&O.dateSearch?c(O.filter.datetime).toISOString():void 0,startDate:!O.viewBySpecificTime&&O.dateSearch?R(O.filter.range.start,"YYYY-MM-DD"):void 0,endDate:!O.viewBySpecificTime&&O.dateSearch?R(O.filter.range.end,"YYYY-MM-DD"):void 0,type:O.filter.groupClassType||void 0,search:O.filter.search,country:O.filter.country||void 0})})},k=()=>{O.readonlyGroupClassReport=!1,O.groupClassReportInfo={groupClassId:void 0,type:y.CANCEL,reason:f.ACCEPTABLE,problemDetail:"",note:"",returnTicket:g.NO}},B=()=>{O.groupClassInfo={id:void 0,topic:"",description:void 0,descriptionEn:void 0,descriptionTh:void 0,descriptionVn:void 0,coachId:void 0,time:"",type:void 0,duration:void 0,accessLimit:void 0,hostId:void 0,service:void 0,level:void 0,link:void 0,studentGroup:void 0,campaign:void 0,curriculumId:void 0,status:void 0}},Y=()=>{O.attend.id=0,O.attend.studentId=void 0,O.attend.time=c().format(),O.attend.type="",O.attend.name=void 0,O.attend.topic="",O.attend.dateTime=""};C((()=>{(()=>{O.viewBySpecificTime="true"===t.query.viewBySpecificTime,O.dateSearch="true"===t.query.dateSearch;const e=t.query.startDate,a=t.query.endDate;t.query.datetime?(O.filter.datetime=new Date(t.query.datetime),O.viewBySpecificTime=!1):e&&a&&(O.filter.range={start:new Date(c(e,"YYYY-MM-DD").toISOString()),end:new Date(c(a,"YYYY-MM-DD").toISOString())});const s=t.query.type;O.filter.groupClassType=s||void 0,O.filter.search=t.query.search;const o=t.query.country;O.filter.country=o||void 0})(),b()})),S((()=>O.filter.search),(()=>{""===O.filter.search&&P()}));const N=v((()=>!(O.groupClassReportInfo.groupClassId&&O.groupClassReportInfo.reason&&O.groupClassReportInfo.type&&O.groupClassReportInfo.problemDetail&&O.groupClassReportInfo.note&&O.groupClassReportInfo.returnTicket)));return d(n({},m(O)),{groupClassHeaders:[{key:"id",label:"ID"},{key:"topic",label:"Topic"},{key:"coach",label:"Coach"},{key:"dateTime",label:"Datetime"},{key:"duration",label:"Duration",isCenter:!0},{key:"level",label:"Level"},{key:"accessLimit",label:"Access Limit",isCenter:!0},{key:"type",label:"Type",isCenter:!0},{key:"country",label:"Country",isCenter:!0},{key:"coachAttend",label:"Coach Attend",isCenter:!0,isRaw:!0},{key:"curriculum",label:"Curriculum",isCenter:!0},{key:"service",label:"Service",isCenter:!0},{key:"link",label:"Link",isCenter:!0},{key:"status",label:"Status",isCenter:!0},{key:"report",label:"Report",isCenter:!0,isRaw:!0}],clearData:()=>{e.push({name:"classrooms-group-classes",params:t.params})},filterChange:P,uploadInputCsv:async e=>{O.uploading=!0;const t=await h(e);return O.uploading=!1,L(t,"Group Class Report was updated!"),t.data},fetchGroupClasses:b,confirmRemoveGroupClass:async e=>{O.isDeleting=!0;const t=await r(e);O.isDeleting=!1,L(t,"Group Class was deleted!"),await b()},setGroupClassStudentInfo:async e=>{const t=await i(+e.id);if(t){let a;a="live"===t.type?A.MASTER_CLASS:"group"===t.type&&(t.campaign||"").includes(I.ENGLISH_SPEAKING_LAB_FOR_JUNIOR)?A.SPEAKING_LAB_JUNIOR:"group"===t.type&&(t.campaign||"").includes(I.ENGLISH_SPEAKING_LAB_FOR_PRETEEN)?A.SPEAKING_LAB_PRETEEN:"group"===t.type&&(t.campaign||"").includes(I.TECH_TALENTS)?A.TECH_TALENTS:"group"===t.type&&(t.campaign||"").includes(I.B2S)?A.B2S_CLASS:"workshop"===t.type?A.WORKSHOP:A.DISCUSSTION_CLASS,O.groupClassStudentInfo.topic=t.topic,O.groupClassStudentInfo.level=t.level,O.groupClassStudentInfo.coach=e.coach,O.groupClassStudentInfo.type=a,O.groupClassStudentInfo.datetime=t.dateTime,O.groupClassStudentInfo.duration=t.duration,O.groupClassStudentInfo.accessLimit=t.accessLimit,O.groupClassStudentInfo.shareLimit=t.shareLimit,O.groupClassStudentInfo.studentBooks=t.studentBooks,O.groupClassStudentInfo.studentAttends=t.studentAttends}},clearGroupClassStudentInfo:async()=>{O.groupClassStudentInfo={topic:"",level:void 0,coach:{id:0,nickname:"",fullname:""},type:void 0,datetime:void 0,duration:0,accessLimit:0,shareLimit:0,studentBooks:[],studentAttends:[]}},clearGroupClassReportInfo:k,clearGroupClassInfo:B,saveGroupClassReport:async()=>{O.isLoading=!0;const e=O.groupClassReportInfo;let t;e.id?(t=await _(e),L(t,"Group Class Report was updated!")):(t=await D(e),L(t,"Group Class Report was created!")),B(),k(),201!==t.status&&200!==t.status||await b(),O.isLoading=!1},setGroupClassReportInfo:async e=>{O.isLoading=!0;const t=await E(e);O.isLoading=!1,t&&(O.groupClassReportInfo=t)},onSaveAttend:async()=>{const e="studentAttend"===O.attend.type?{studentAttend:O.attend.time,studentId:O.attend.studentId}:{coachAttend:O.attend.time};O.attend.isLoadingAttend=!0;const t=await w(O.attend.id,e);L(t,`Add ${"studentAttend"===O.attend.type?"Student":"Coach"} Attend Success!`),Y(),await b(),O.attend.isLoadingAttend=!1},clearAttend:Y,disabledSaveGroupClassReport:N})}function E(){const e=v((()=>({canCreateGroupClass:h(["CREATE_GROUP_CLASS"]),canUploadGroupClassCsv:h(["UPLOAD_GROUP_CLASS_CSV"]),canViewGroupClassDetails:h(["VIEW_GROUP_CLASS_DETAILS"]),canEditGroupClass:h(["UPDATE_GROUP_CLASS"]),canDeleteGroupClass:h(["DELETE_GROUP_CLASS"]),canViewGroupClassReport:h(["VIEW_GROUP_CLASS_REPORT"]),canCreateGroupClassReport:h(["CREATE_GROUP_CLASS_REPORT"]),canEditGroupClassReport:h(["EDIT_GROUP_CLASS_REPORT"]),canViewGroupClassStudent:h(["VIEW_LIST_OF_GROUP_CLASS_STUDENT"]),canAddGroupClassAttend:h(["EDIT_GROUP_CLASS_ATTEND"])}))),t=v((()=>Object.values(e.value).some((e=>e))));return{capabilities:e,haveActionButton:t}}export{E as a,D as u};
