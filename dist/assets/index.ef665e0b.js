var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,r=(e,a)=>{for(var t in a||(a={}))l.call(a,t)&&i(e,t,a[t]);if(s)for(var t of s(a))n.call(a,t)&&i(e,t,a[t]);return e},o=(e,s)=>a(e,t(s));import{a as c,p as u,c as d}from"./index.d7dc1ff6.js";import{_ as p,a as m}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as f}from"./SelectOption.vue_vue&type=script&setup=true&lang.934e0be4.js";import{_ as v}from"./VIconBox.vue_vue&type=script&setup=true&lang.7bffdb35.js";import{_ as g}from"./VTag.vue_vue&type=script&setup=true&lang.b31af8ee.js";import{_ as b}from"./VTags.vue_vue&type=script&setup=true&lang.156e160d.js";import{_ as h}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{c as y}from"./student.helper.13430dac.js";import{d as _,o as x,e as j,I as O,h as D,x as w,g as k,t as I,n as R,F as V,H as M,y as L,A as P,q as T,k as A,Y as q,ae as C,T as S,i as U,K as Y,ai as z,V as E,G as F,p as H,a as N}from"./vendor.1c8b4573.js";import{_ as B}from"./VFlexTable.vue_vue&type=script&setup=true&lang.471c5ad3.js";import{i as G}from"./avatar.helper.68db04c2.js";import{t as K}from"./date.helper.6ae3fc87.js";import{u as $}from"./useOptionApi.f4dc99b9.js";import{u as J}from"./usePermissionApi.9e405600.js";import{u as Q}from"./useGuardRole.ebe65201.js";import"./student.enum.ad6af513.js";import"./index.ec15dc7d.js";import"./lodash.0a1ccad5.js";import"./quiz.enum.fc8b95fc.js";const W={class:"flex-table-cell is-media is-grow"},X={class:"item-name dark-inverted"},Z={class:"item-meta"},ee={class:"flex-table-cell","data-th":"Name"},ae={class:"light-text"},te={class:"flex-table-cell","data-th":"Status"},se={class:"flex-table-cell","data-th":"Manage"},le={class:"flex-table-cell","data-th":"Last Login"},ne={class:"light-text"};var ie=_({props:{rows:{type:Array,required:!0}},setup(e){const a=e;return(e,t)=>{const s=c,l=g,n=b;return x(!0),j(M,null,O(a.rows,(e=>(x(),j("div",{key:e.id,class:"flex-table-item"},[D("div",W,[w(s,{badge:k(y)[e.country],picture:e.avatar?e.avatar:void 0,initials:e.initials,color:e.color||void 0,size:"medium"},null,8,["badge","picture","initials","color"]),D("div",null,[D("span",X,I(e.firstname)+" "+I(e.lastname),1),D("span",Z,[D("span",null,I(e.email),1)])])]),D("div",ee,[D("span",ae,I(e.name),1)]),D("div",te,[D("span",{class:R(["tag is-rounded",[1===e.status?"is-success":"Disabled"]])},I(1===e.status?"Active":"Deactive"),3)]),D("div",se,[w(n,null,{default:V((()=>[(x(!0),j(M,null,O(e.manageCountry,(e=>(x(),L(l,{key:e,label:e,color:"primary",curved:"",outlined:""},null,8,["label"])))),128))])),_:2},1024)]),D("div",le,[D("span",ne,I(e.lastLogin),1)])])))),128)}}});function re(){const{getRoleById:e,getMenus:a,getRoleUsers:t}=J(),{getTeams:s}=$(),l=P(),n=T({roleData:void 0,menuItems:[],teamOptions:[],loadingRole:!1,menuLoading:!1,loadingOption:!1}),i=A((()=>n.menuItems.reduce(((e,a)=>{let t=0;const s=a.subMenus.filter((({actions:e})=>{const a=(e||[]).filter((e=>e.selected));return(null==a?void 0:a.length)>0&&(t+=a.length,!0)}));return(null==s?void 0:s.length)>0&&e.push({name:a.name,icon:"feather:file-plus",actions:t,subtitles:null==s?void 0:s.length,subMenus:s.map((({name:e,actions:a})=>({name:e,actions:(a||[]).filter((({selected:e})=>e)).map((e=>({id:e.id,name:e.actionName})))})))}),e}),[]))),c=A((()=>{var e,a;return null==(a=null==(e=n.roleData)?void 0:e.users)?void 0:a.map((e=>{const{firstname:a,lastname:t,lastLogin:s}=e,{initials:l,color:n}=G(a,t);return{lastLogin:K(s,"MMM D, YYYY HH:mm"),manageCountry:e.manageCountry,country:e.country,avatar:e.avatar,status:e.status,email:e.email,name:e.name,firstname:a,lastname:t,initials:l,color:n}}))})),u=async e=>(n.loadingOption=!0,n.teamOptions=await s({currentPage:1,perPage:25,search:e}),n.loadingOption=!1,n.teamOptions);return q((async()=>{await(async a=>{var s;n.loadingRole=!0;const[l,i]=await Promise.all([t(a),e(a)]);i&&l&&(n.roleData=i,n.roleData&&(n.roleData.name=i.name||"",n.roleData.description=i.description||"",n.roleData.teamId=null==(s=i.team)?void 0:s.id,n.roleData.users=l.users),n.loadingRole=!1)})(parseInt(`${l.params.id}`)),(async()=>{var e;if(n.menuLoading=!0,n.roleData){const t=null==(e=n.roleData.permissions)?void 0:e.map((({id:e})=>e)),s=await a();n.menuItems=s.map((e=>{let a=0;const s=e.subMenus.map((e=>{const s=e.permissions.map((e=>{const a=null==t?void 0:t.includes(e.id);return o(r({},e),{selected:a})}));return a+=s.length,o(r({},e),{actions:s})}));return o(r({},e),{show:!1,subtitles:s.length,actions:a,icon:"feather:file-plus",subMenus:s})}))}n.menuLoading=!1})(),u()})),o(r({},C(n)),{selectedItems:i,userData:c,fetchTeamsOption:u})}H("data-v-02c0933c");const oe={class:"box-container"},ce={key:0,class:"box-permission"},ue={class:"py-4"},de=D("h3",{class:"text-header"},"Role Details",-1),pe={class:"is-flex is-justify-content-flex-end"},me=F("Edit"),fe=D("label",null,"Role name",-1),ve={class:"help has-text-danger"},ge=D("label",null,"Role description",-1),be={class:"help has-text-danger"},he=D("label",null,"Team",-1),ye={class:"help has-text-danger"},_e={key:0},xe=["data-icon"],je={class:"flex-meta"},Oe=D("i",{class:"fas fa-list"},null,-1),De=D("i",{class:"lnir lnir-bookmark"},null,-1),we={class:"pb-1"},ke=D("div",{class:"flex-table-header"},[D("span",{class:"is-grow"},"User"),D("span",null,"Name"),D("span",null,"Status"),D("span",null,"Manage"),D("span",null,"Last Login")],-1);N();var Ie=_({setup(e){u.value="Role Details";const{roleData:a,teamOptions:t,loadingRole:s,loadingOption:l,userData:n,selectedItems:i,fetchTeamsOption:r}=re(),{capabilities:o}=Q(),{y:c}=S();return A((()=>c.value>300)),(e,t)=>{const c=d,u=p,y=m,_=f,R=v,P=g,T=b,A=h,q=ie,C=B;return x(),j("div",oe,[k(a)&&!k(s)?(x(),j("div",ce,[w(A,null,{default:V((()=>[D("div",ue,[de,D("div",pe,[k(o).canEdit?(x(),L(c,{key:0,icon:"feather:edit",color:"primary",to:{name:"permissions-roles-:id-edit"},outlined:""},{default:V((()=>[me])),_:1})):U("",!0)])]),D("div",null,[w(y,null,{default:V((()=>[fe,w(u,{icon:"lnil lnil-protection"},{default:V((()=>[Y(D("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>k(a).name=e),type:"text",class:"input",disabled:"",placeholder:"Role name"},null,512),[[z,k(a).name]])])),_:1}),Y(D("p",ve," Role name required atleast 4 characters. ",512),[[E,k(a).name.trim().length<4]])])),_:1}),w(y,null,{default:V((()=>[ge,w(u,null,{default:V((()=>[Y(D("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>k(a).description=e),class:"textarea",rows:"3",disabled:"",placeholder:"A description for this role..."},null,512),[[z,k(a).description]])])),_:1}),Y(D("p",be," Role description required atleast 12 characters. ",512),[[E,k(a).description.trim().length<12]])])),_:1}),w(y,{class:"is-autocomplete-select"},{default:V((()=>[he,w(u,{icon:"feather:search",loading:k(l)},{default:V((()=>[w(_,{modelValue:k(a).teamId,"onUpdate:modelValue":t[2]||(t[2]=e=>k(a).teamId=e),"callback-search":k(r),disabled:"","tract-by":"name","value-prop":"id",placeholder:"Select team"},null,8,["modelValue","callback-search"]),Y(D("p",ye," Choose team for this role. ",512),[[E,!k(a).teamId]])])),_:1},8,["loading"])])),_:1})]),k(i).length>0?(x(),j("div",_e,[(x(!0),j(M,null,O(k(i),((e,a)=>(x(),j("div",{key:a,class:"media-flex"},[w(R,{key:e.icon,size:"small",color:"primary"},{default:V((()=>[D("i",{class:"iconify","data-icon":e.icon},null,8,xe)])),_:2},1024),D("div",je,[D("span",null,I(e.name),1),D("span",null,[Oe,F(" "+I(e.subtitles)+" subtitles ",1),De,F(" "+I(e.actions)+" actions",1)]),(x(!0),j(M,null,O(e.subMenus,((e,a)=>(x(),j("div",{key:a,class:"pt-2"},[D("h3",we,I(e.name),1),w(T,{class:"mb-1"},{default:V((()=>[(x(!0),j(M,null,O(e.actions,((e,a)=>(x(),L(P,{key:a,label:e.name.replace(/_/g," ")},null,8,["label"])))),128))])),_:2},1024)])))),128))])])))),128))])):U("",!0)])),_:1}),w(C,{class:"pt-5"},{header:V((()=>[ke])),body:V((()=>[w(q,{rows:k(n)},null,8,["rows"])])),_:1})])):U("",!0)])}}});Ie.__scopeId="data-v-02c0933c";export default Ie;
