var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,n=(a,l,d)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[l]=d,i=(e,a)=>{for(var l in a||(a={}))c.call(a,l)&&n(e,l,a[l]);if(d)for(var l of d(a))t.call(a,l)&&n(e,l,a[l]);return e},o=(e,d)=>a(e,l(d));import{c as u,h as s,e as r}from"./index.d7dc1ff6.js";import{_ as p}from"./VTag.vue_vue&type=script&setup=true&lang.b31af8ee.js";import{_ as k}from"./VBlock.vue_vue&type=script&setup=true&lang.2e664adb.js";import{_ as g}from"./V-Snack.vue_vue&type=script&setup=true&lang.68124dfe.js";import{_ as v}from"./VCard.vue_vue&type=script&setup=true&lang.27754e87.js";import{_ as m}from"./SelectOption.vue_vue&type=script&setup=true&lang.934e0be4.js";import{_ as f,a as I}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as P}from"./VRadio.89eaf975.js";import{g as y}from"./package.enum.de4ee89f.js";import{u as b}from"./useOptionApi.f4dc99b9.js";import{d as _,r as h,o as T,e as V,h as G,x as w,F as x,G as j,p as A,a as C,k as N,S as U,E,H as O,g as S,t as M,K as $,ai as q,i as B,y as R,V as K,q as D,A as F,b as H,ae as Y}from"./vendor.1c8b4573.js";import{_ as z}from"./VSwitchBlock.vue_vue&type=script&setup=true&lang.fd20ebd0.js";import{_ as J}from"./FormTemplate.a6fb27bf.js";import{u as L}from"./useGuardPackageGroup.86b7884e.js";import{u as Q}from"./usePackageApi.47154a43.js";import{u as W}from"./useNotyf.ddf08f06.js";const X={class:"form-fieldset"},Z=G("div",{class:"fieldset-heading"},[G("h4",null,"Main Package"),G("p",null,"Select main package")],-1),ee={class:"columns is-multiline"},ae={class:"column is-12"},le=G("label",null,"Main Package",-1),de={class:"column is-12"},ce=G("label",null,"Generate Ticket",-1),te={class:"button-submit"},ne=j("Cancel"),ie=j("Add Main Package");var oe=_({props:{mainPackage:{type:Object,default:void 0},packageGroup:{type:Array,default:()=>[]}},emits:{"on-update":Object},setup(e,{emit:a}){var l;const d=e,{getPackages:c}=b();h((null==(l=d.mainPackage)?void 0:l.generateTicket)||y.NOT_GENERATE_TICKET);const t=h(d.mainPackage||{idx:void 0,packageId:0,generateTicket:y.NOT_GENERATE_TICKET}),n=async e=>{const a=t.value.packageName;return(await c(e||a)).filter((e=>d.packageGroup.filter((a=>a.packageId!==e.id))))},i=(e,a)=>{t.value.packageName=a.packageName,t.value.packageTicket=a.ticket},o=()=>{t.value.packageId=0,t.value.packageName=t.value.packageTicket=void 0},s=()=>{a("on-update",t.value)};return(e,a)=>{const l=m,d=f,c=I,r=P,p=u;return T(),V("div",X,[Z,G("div",ee,[G("div",ae,[w(c,null,{default:x((()=>[le,w(d,null,{default:x((()=>[w(l,{modelValue:t.value.packageId,"onUpdate:modelValue":[a[0]||(a[0]=e=>t.value.packageId=e),i],placeholder:"Search for select a main package","callback-search":n,"label-by":"packageName","value-prop":"id",onClear:o},null,8,["modelValue"])])),_:1})])),_:1})]),G("div",de,[w(c,null,{default:x((()=>[ce,w(d,null,{default:x((()=>[w(r,{modelValue:t.value.generateTicket,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.generateTicket=e),value:"1",label:"Yes",name:"outlined_squared_radio",color:"success",square:""},null,8,["modelValue"]),w(r,{modelValue:t.value.generateTicket,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.generateTicket=e),value:"0",label:"No",name:"outlined_squared_radio",color:"primary",square:""},null,8,["modelValue"])])),_:1})])),_:1})])]),G("div",te,[w(p,null,{default:x((()=>[ne])),_:1}),w(p,{color:"primary",disabled:!t.value.packageId,class:"ml-3",onClick:s},{default:x((()=>[ie])),_:1},8,["disabled"])])])}}});A("data-v-05602886");const ue={class:"form-fieldset"},se=G("div",{class:"fieldset-heading"},[G("h4",null,"Addon Package"),G("p",null,"Select addon package and order in package group")],-1),re={class:"columns is-multiline"},pe={class:"column is-12"},ke=G("label",null,"Addon Package",-1),ge={class:"column is-12"},ve={class:"column is-8"},me=G("label",null,"Depend on package",-1),fe={class:"multiselect-single-label"},Ie={class:"select-option-text"},Pe={class:"column is-4"},ye=["max"],be=j("Add"),_e=j("Cancel");C();var he=_({props:{groupPackages:{type:Array,default:()=>[]},currentAddonPackage:{type:Object,default:void 0}},emits:["cancel","add","edit"],setup(e,{emit:a}){var l;const d=e,{getPackages:c}=b(),t=h(d.currentAddonPackage||{idx:void 0,packageId:0,generateTicket:y.GENERATE_TICKET}),n=N((()=>{var e;return(null==(e=d.groupPackages.find((e=>e.packageId===t.value.dependonPackageId)))?void 0:e.packageTicket)||0})),s=h(!!(null==(l=d.currentAddonPackage)?void 0:l.dependonPackageId)||!1),r=N((()=>d.groupPackages.filter((e=>e.idx!==t.value.idx)))),p=(e,a)=>{t.value.packageName=a.packageName,t.value.packageTicket=a.ticket},k=async e=>{var a;const l=null==(a=d.currentAddonPackage)?void 0:a.packageName,t=await c(e||l);return await t.filter((e=>{var a;return d.groupPackages.every((a=>a.packageId!==e.id))||(null==(a=d.currentAddonPackage)?void 0:a.packageId)===e.id}))},g=e=>{parseInt(e)<0&&(t.value.dependonTicketUse=0)},v=()=>{d.currentAddonPackage?a("edit",t.value):a("add",t.value)};return U((()=>s.value),(async e=>{e||(t.value=o(i({},t.value),{dependonPackageId:void 0,dependonTicketUse:void 0}))})),U((()=>d.currentAddonPackage),(e=>{var a;e&&(t.value=d.currentAddonPackage,s.value=!!(null==(a=d.currentAddonPackage)?void 0:a.dependonPackageId))})),(e,l)=>{const d=m,c=f,i=I,o=z,P=E("Multiselect"),y=u;return T(),V("div",ue,[se,G("div",re,[G("div",pe,[w(i,null,{default:x((()=>[ke,w(c,null,{default:x((()=>[w(d,{modelValue:t.value.packageId,"onUpdate:modelValue":[l[0]||(l[0]=e=>t.value.packageId=e),p],placeholder:"Select a main package","callback-search":k,"label-by":"packageName","value-prop":"id"},null,8,["modelValue"])])),_:1})])),_:1})]),G("div",ge,[w(i,null,{default:x((()=>[w(c,null,{default:x((()=>[w(o,{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value=e),label:"Package have depend on",color:"primary"},null,8,["modelValue"])])),_:1})])),_:1})]),s.value?(T(),V(O,{key:0},[G("div",ve,[w(i,null,{default:x((()=>[me,w(c,null,{default:x((()=>[w(P,{modelValue:t.value.dependonPackageId,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.dependonPackageId=e),placeholder:"select depend on package",options:S(r),"track-by":"packageName","value-prop":"packageId"},{singlelabel:x((({value:e})=>[G("div",fe," ("+M(e.packageId)+") "+M(e.packageName),1)])),option:x((({option:e})=>[G("span",Ie," ("+M(e.packageId)+") "+M(e.packageName),1)])),_:1},8,["modelValue","options"])])),_:1})])),_:1})]),G("div",Pe,[w(i,null,{default:x((()=>[G("label",null,"Ticket used (max: "+M(S(n))+")",1),w(c,{icon:"feather:hash"},{default:x((()=>[$(G("input",{"onUpdate:modelValue":[l[3]||(l[3]=e=>t.value.dependonTicketUse=e),g],min:"0",max:S(n),type:"number",class:"input",placeholder:"",onChange:l[4]||(l[4]=e=>t.value.dependonTicketUse=+t.value.dependonTicketUse)},null,40,ye),[[q,t.value.dependonTicketUse]])])),_:1})])),_:1})])],64)):B("",!0)]),w(y,{color:"primary",icon:"fas fa-plus",bold:"",fullwidth:"",onClick:v},{default:x((()=>[be])),_:1}),w(y,{icon:"fas fa-times",bold:"",fullwidth:"",class:"mt-3",onClick:l[5]||(l[5]=e=>a("cancel"))},{default:x((()=>[_e])),_:1})])}}});he.__scopeId="data-v-05602886",A("data-v-623fd28e");const Te=j(" Cancel "),Ve=j(" Create "),Ge=j(" Update "),we=j(" Edit "),xe={class:"form-section is-grey"},je={class:"mx-3"},Ae=["onClick"],Ce=[G("div",{class:"icon"},[G("i",{"aria-hidden":"true",class:"lnil lnil-pencil"})],-1),G("div",{class:"meta"},[G("span",null,"Edit"),G("span",null,"edit this package")],-1)],Ne=["onClick"],Ue=[G("div",{class:"icon"},[G("i",{"aria-hidden":"true",class:"lnil lnil-trash"})],-1),G("div",{class:"meta"},[G("span",null,"Remove"),G("span",null,"remove this package")],-1)],Ee={class:"package-detail"},Oe=G("div",null,null,-1),Se=G("div",null,null,-1),Me=G("div",null,null,-1),$e=G("div",null,null,-1),qe={key:0,class:"p-3 right"},Be=j("Add addon package");C();var Re=_({props:{title:{type:String,default:"Create Package Group"},packageGroup:{type:Object,default:void 0},mode:{type:String,default:"create"}},emits:["create","update","cancel","update-main-package"],setup(e,{emit:a}){const l=e,{capabilities:d}=L(),c=N((()=>"view"===l.mode)),t=N((()=>"edit"===l.mode)),n=h(!0),r=h(!1),m=h(void 0),f=h(void 0),I=h([]),P=e=>{var a;return(null==(a=m.value)?void 0:a.packageId)===e},y=()=>{t.value?a("update",{mainPackage:m.value,addonPackages:I.value}):a("create",{mainPackage:m.value,addonPackages:I.value})},b=e=>{if(m.value=e,e.idx){const a=I.value.findIndex((a=>a.packageId===e.packageId));a>=0&&I.value.splice(a,1);const l=I.value.findIndex((a=>a.idx===e.idx));I.value[l]=e}else I.value.push(o(i({},m.value),{idx:I.value.length+1}));n.value=!1},_=e=>{I.value.push(o(i({},e),{idx:I.value.length+1})),r.value=!1},j=e=>{const a=I.value.findIndex((a=>a.idx===e.idx));I.value[a]=e,f.value=void 0,r.value=!1},A=()=>{I.value=I.value.map(((e,a)=>o(i({},e),{idx:a+1})))};return U((()=>l.packageGroup),(()=>{var e,a;const d=null==(e=l.packageGroup)?void 0:e.find((e=>e.isMainPackage));I.value=(null==(a=l.packageGroup)?void 0:a.map((e=>({packageGroupId:e.id,packageId:e.packageId,generateTicket:e.generateTicket,idx:e.idx,dependonPackageId:e.dependonPackageId,dependonTicketUse:e.dependonTicketUse,packageName:e.packageInfo.packageName,packageTicket:e.packageInfo.ticket}))))||[],d&&(m.value={packageGroupId:d.id,packageId:d.packageId,generateTicket:d.generateTicket,idx:d.idx,dependonPackageId:d.dependonPackageId,dependonTicketUse:d.dependonTicketUse,packageName:d.packageInfo.packageName,packageTicket:d.packageInfo.ticket},n.value=!1)})),(l,i)=>{const o=u,h=p,C=s,N=k,U=g,M=v,q=E("VueDraggable"),D=oe,F=he,H=J;return T(),R(H,{title:e.title},{buttons:x((()=>[S(c)?B("",!0):(T(),R(o,{key:0,icon:"lnir lnir-arrow-left rem-100",light:"","dark-outlined":"",onClick:i[0]||(i[0]=e=>a("cancel"))},{default:x((()=>[Te])),_:1})),"create"===e.mode?(T(),R(o,{key:1,color:"primary",disabled:I.value.length<2,raised:"",onClick:y},{default:x((()=>[Ve])),_:1},8,["disabled"])):B("",!0),S(d).canEdit?(T(),V(O,{key:2},[S(t)?(T(),R(o,{key:0,color:"primary",disabled:I.value.length<2,raised:"",onClick:y},{default:x((()=>[Ge])),_:1},8,["disabled"])):B("",!0),S(c)?(T(),R(o,{key:1,to:"#edit",color:"primary",raised:"",onClick:y},{default:x((()=>[we])),_:1})):B("",!0)],64)):B("",!0)])),default:x((()=>[$(G("div",xe,[w(q,{modelValue:I.value,"onUpdate:modelValue":i[1]||(i[1]=e=>I.value=e),"item-key":"packageId",class:"list-group","ghost-class":"ghost",disabled:n.value||r.value,onChange:A},{item:x((({element:e})=>[w(M,{class:"package-row-drag"},{default:x((()=>{return[w(N,{title:`[id: ${e.packageId}] ${e.packageName||e.packageId}`},{action:x((()=>[G("div",je,[w(h,{color:P(e.packageId)?"danger":"blue",label:P(e.packageId)?"Main Package":"Addon Package",curved:""},null,8,["color","label"])]),S(t)?(T(),R(C,{key:0,icon:"feather:more-vertical",color:"primary",spaced:"",right:""},{content:x((()=>{var a;return[G("a",{role:"menuitem",class:"dropdown-item is-media",onClick:a=>(e=>{var a;e.packageId===(null==(a=m.value)?void 0:a.packageId)?n.value=!0:(f.value=e,r.value=!0)})(e)},Ce,8,Ae),e.packageId!==(null==(a=m.value)?void 0:a.packageId)?(T(),V("a",{key:0,role:"menuitem",class:"dropdown-item is-media",onClick:a=>(e=>{const a=I.value.findIndex((a=>a.packageId===e.packageId));I.value.splice(a,1),I.value.map((a=>(a.dependonPackageId===e.packageId&&(a.dependonPackageId=a.dependonTicketUse=void 0),a))),A()})(e)},Ue,8,Ne)):B("",!0)]})),_:2},1024)):B("",!0)])),_:2},1032,["title"]),G("div",Ee,["1"===e.generateTicket?(T(),R(U,{key:0,title:"Generate Ticket",color:"success",white:"",solid:"",icon:"feather:plus-circle"},{default:x((()=>[Oe])),_:1})):B("",!0),"0"===e.generateTicket?(T(),R(U,{key:1,title:"Not Generate Ticket",color:"danger",white:"",solid:"",icon:"feather:minus-circle"},{default:x((()=>[Se])),_:1})):B("",!0),e.dependonPackageId?(T(),R(U,{key:2,title:`(id: ${e.dependonPackageId}) ${a=e.dependonPackageId,(null==(l=I.value.find((e=>e.packageId===a)))?void 0:l.packageName)||`${a}`}`,color:"warning",white:"",solid:"",icon:"feather:alert-triangle"},{default:x((()=>[Me])),_:2},1032,["title"])):B("",!0),e.dependonTicketUse?(T(),R(U,{key:3,title:`Ticket Used: ${e.dependonTicketUse}`,color:"success",white:"",solid:"",icon:"feather:hash"},{default:x((()=>[$e])),_:2},1032,["title"])):B("",!0)])];var a,l})),_:2},1024)])),_:1},8,["modelValue","disabled"]),"view"===e.mode||n.value||r.value?B("",!0):(T(),V("div",qe,[n.value||r.value?B("",!0):(T(),R(o,{key:0,onClick:i[2]||(i[2]=e=>r.value=!0)},{default:x((()=>[Be])),_:1}))]))],512),[[K,!n.value]]),n.value?(T(),R(D,{key:0,"main-package":m.value,onOnUpdate:b},null,8,["main-package"])):B("",!0),r.value&&m.value?(T(),R(F,{key:1,"group-packages":I.value,"current-addon-package":f.value,onAdd:_,onEdit:j,onCancel:i[3]||(i[3]=e=>r.value=!1)},null,8,["group-packages","current-addon-package"])):B("",!0)])),_:1},8,["title"])}}});function Ke(){const e=D({packageGroupInfo:[]}),a=W(),l=F(),d=H(),c=N((()=>"#edit"===l.hash)),{createPackageGroup:t,updatePackageGroup:n,getAddonPackageByMainPackageId:u,deleteAddonPackageGroupById:s}=Q(),p=async e=>{await s(e)};return o(i({},Y(e)),{isEditPage:c,createPackageGroup:async e=>{const{status:l,message:c}=await t({mainPackageId:e.mainPackage.packageId,addonPackages:e.addonPackages});if(201===l)return a.success("Created Success!"),void d.push({name:"products-packages-groups-:packageid",params:{packageid:`${e.mainPackage.packageId}`}});a.error(r(c))},editPackageGroup:async l=>{if(e.packageGroupInfo){e.packageGroupInfo.find((e=>e.isMainPackage)),await Promise.all(e.packageGroupInfo.map((async e=>{l.addonPackages.some((a=>a.packageId===e.packageId))||await p({packageId:e.packageId,packageGroupId:e.id})})));const{error:c,message:t}=await n({mainPackageId:l.mainPackage.packageId,addonPackages:l.addonPackages});c?a.error(r(t)):d.push({name:"products-packages-groups-:packageid",params:{packageid:`${l.mainPackage.packageId}`}})}},fetchPackageInfo:async a=>{const l=await u(a);e.packageGroupInfo=l},removePackageById:p,routeToView:()=>{c.value&&d.push({hash:""})}})}Re.__scopeId="data-v-623fd28e";export{Re as _,Ke as u};
