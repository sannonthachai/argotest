var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{u as i,a as u,h as o,c as d,d as n,f as r,n as c,o as p}from"./index.d7dc1ff6.js";import{_ as v,a as m}from"./VField.vue_vue&type=script&setup=true&lang.ef5e6c86.js";import{_ as f}from"./VRadio.89eaf975.js";import{t as y}from"./date.helper.6ae3fc87.js";import{i as b}from"./avatar.helper.68db04c2.js";import{k as h,p as I,a as S,d as _,o as g,e as E,I as C,h as V,t as T,g as k,n as A,x as O,G as w,y as D,F as j,i as x,H as U,Y as M,E as Y,T as R,b as B,A as q,r as L,D as P,K as N,ai as H,V as G,ao as $,ap as F}from"./vendor.1c8b4573.js";import{u as z,_ as K}from"./ModalReportCall.c9babeff.js";import{_ as J}from"./VModal.31b4f4ba.js";import{r as Q}from"./reactivity.esm-bundler.07132181.js";import{u as W}from"./usePermissionApi.9e405600.js";import{_ as X}from"./ConfirmModal.c43c7733.js";import{b as Z,c as ee,d as ae,e as le}from"./student.enum.ad6af513.js";import{u as te}from"./useStudentApi.e8de2a80.js";import"./index.ec15dc7d.js";import"./lodash.0a1ccad5.js";import"./useLogApi.90f2b872.js";import"./useNotyf.ddf08f06.js";import"./VPlaceholderSection.vue_vue&type=script&setup=true&lang.35b0ad2a.js";I("data-v-0fa12896");const se={class:"date"},ie={class:"content-wrap"},ue={class:"content-box"},oe={class:"box-text"},de={class:"meta-text"},ne=w(" has a report call type "),re=w(" as "),ce=w(", in topic "),pe={class:"align-center"},ve=V("i",{class:"iconify mr-2","data-icon":"feather:clock"},null,-1),me=V("i",{class:"fas fa-circle icon-separator"},null,-1),fe=["data-icon"],ye=V("i",{class:"fas fa-circle icon-separator"},null,-1),be=V("i",{class:"iconify mr-2","data-icon":"feather:cast"},null,-1),he=V("i",{class:"fas fa-circle icon-separator"},null,-1),Ie=["data-icon"],Se=["onClick"],_e=[V("div",{class:"icon"},[V("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:file-text"})],-1),V("div",{class:"meta"},[V("span",null,"Edit Report Call"),V("span",null,"edit student report call")],-1)],ge=["onClick"],Ee=[V("div",{class:"icon"},[V("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:mail"})],-1),V("div",{class:"meta"},[V("span",null,"Sent Survey"),V("span",null,"sent satisfaction survey")],-1)];S();var Ce=_({props:{items:{type:Array,required:!0,default:()=>[]},typeOption:{type:Array,required:!0,default:()=>[]},classType:{type:Array,required:!0,default:()=>[]}},emits:["select-report-call","select-satisfaction-survey"],setup(e,{emit:a}){const l=e,{capabilities:t,haveActionButton:s}=function(){const e=h((()=>({canEdit:i(["EDIT_STUDENT_REPORT_CALL"]),canCreateStudentSurvey:i(["CREATE_STUDENT_SURVEY"])}))),a=h((()=>Object.values(e.value).some((e=>e))));return{capabilities:e,haveActionButton:a}}(),d=e=>{const a=l.typeOption.find((a=>a.value===e));return(null==a?void 0:a.key)||"Unknown"},n=e=>{const a=l.classType.find((a=>a.value===e));return(null==a?void 0:a.key)||"Unknown"},r=e=>"red"===e?"frown":"yellow"===e?"meh":"smile",c=e=>{const a=e.updatedBy||e.createdBy,l=(null==a?void 0:a.fullname)||"Anonymus",[t,s]=l.split(" ").filter((e=>!!e));return b(t,s)},p=e=>{var a,l;return e.updatedBy?null==(a=e.updatedBy)?void 0:a.fullname:(null==(l=e.createdBy)?void 0:l.fullname)||"Anonymus"};return(l,i)=>{const v=u,m=o;return g(!0),E(U,null,C(e.items,(e=>{return g(),E("div",{key:e.id,class:"timeline-item is-unread"},[V("div",se,[V("span",null,T(k(y)(e.createdAt,"YYYY, MMM D HH:mm")),1)]),V("div",{class:A(["dot",(u=e.satisfaction,"red"===u?"is-danger":"yellow"===u?"is-warning":"is-success")])},null,2),V("div",ie,[V("div",ue,[O(v,{initials:c(e).initials,color:c(e).color},null,8,["initials","color"]),V("div",oe,[V("div",de,[V("p",null,[V("span",null,T(p(e)),1),ne,V("a",null,T(d(e.type)),1),re,V("small",{class:A(["tag","is-rounded",(i=e.classType,"private"===i?"is-info":"is-purple")])},T(n(e.classType)),3),ce,V("a",null,T(e.topic),1),w(" - "+T(e.detail)+". ",1)]),V("span",pe,[ve,w(" "+T(k(y)(e.datetime,"MMM D, YYYY HH:mm"))+" ",1),me,V("i",{class:"iconify mr-2","data-icon":"solved"===e.status?"feather:check-circle":"feather:minus-circle"},null,8,fe),V("span",{class:A(e.status)},T((l=e.status,l.charAt(0).toUpperCase()+l.substr(1).toLowerCase())),3),ye,be,w(" Class ID: "+T(e.classId)+" ",1),he,V("i",{class:"iconify mr-2","data-icon":`feather:${r(e.satisfaction)}`},null,8,Ie),w(" "+T(r(e.satisfaction)),1)])]),k(s)?(g(),D(m,{key:0,icon:"feather:more-vertical",spaced:"",right:""},{content:j((()=>[k(t).canEdit?(g(),E("a",{key:0,role:"menuitem",class:"dropdown-item is-media",onClick:l=>a("select-report-call",e)},_e,8,Se)):x("",!0),k(t).canCreateStudentSurvey&&!e.classId?(g(),E("a",{key:1,role:"menuitem",class:"dropdown-item is-media",onClick:l=>a("select-satisfaction-survey",e)},Ee,8,ge)):x("",!0)])),_:2},1024)):x("",!0)])])])]);var l,i,u})),128)}}});Ce.__scopeId="data-v-0fa12896";I("data-v-6d2c16fb");const Ve={class:"modal-form"},Te=V("label",null,[w("User evaluated"),V("span",{class:"red"}," * ")],-1),ke={class:"multiselect-single-label"},Ae={class:"select-option-text"},Oe=V("p",{class:"help"},"*select user for evaluated",-1),we=w("Save");S();var De=_({props:{openModal:{type:Boolean,required:!0,default:!1},userEvaluatedId:{type:Number,default:0},disabledSave:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},emits:["toggle-close","on-select","on-save"],setup(e,{emit:a}){const l=e,{getTeamById:t}=W(),s=Q(),i=(e,l)=>{a("on-select",e,l.name)};return M((async()=>{const e=await t(4);s.value=e.admins})),(t,u)=>{const o=Y("Multiselect"),n=v,r=m,c=d,p=J;return g(),D(p,{open:null==l?void 0:l.openModal,size:"medium",actions:"right",title:"Select admin evaluated",onClose:u[2]||(u[2]=e=>a("toggle-close"))},{content:j((()=>[V("form",Ve,[O(r,null,{default:j((()=>[Te,O(n,null,{default:j((()=>[O(o,{modelValue:l.userEvaluatedId,"onUpdate:modelValue":u[0]||(u[0]=e=>l.userEvaluatedId=e),options:s.value,"value-prop":"id","track-by":"name",label:"name",placeholder:"Select user evaluated",disabled:null==l?void 0:l.readonly,"preselect-first":!0,onSelect:i},{singlelabel:j((({value:e})=>[V("div",ke," ("+T(e.id)+") "+T(e.name),1)])),option:j((({option:e})=>[V("span",Ae," ("+T(e.id)+") "+T(e.name),1)])),_:1},8,["modelValue","options","disabled"]),Oe])),_:1})])),_:1})])])),action:j((()=>[O(c,{color:"primary",raised:"",disabled:e.disabledSave,onClick:u[1]||(u[1]=e=>a("on-save"))},{default:j((()=>[we])),_:1},8,["disabled"])])),_:1},8,["open"])}}});De.__scopeId="data-v-6d2c16fb",I("data-v-9f4dade2");const je={class:"page-content-inner"},xe={class:"account-box is-form is-footerless"},Ue={class:"form-head-inner"},Me=V("div",{class:"left"},[V("h3",null,"Report Call"),V("p",null,"Create student's report call")],-1),Ye={class:"right"},Re={class:"has-text-right"},Be=w(" Save "),qe={class:"form-body"},Le={class:"modal-form"},Pe=V("label",null,"Topic",-1),Ne={class:"v-fade help text-danger"},He=V("label",null,"Date",-1),Ge=["value"],$e={class:"columns"},Fe={class:"column is-half"},ze=V("label",null,"Type",-1),Ke={class:"v-fade help text-danger"},Je={class:"column is-half"},Qe=V("label",null,"Class Type",-1),We=V("p",{class:"help"}," *If you fill classId, this field is required ",-1),Xe=V("label",null,"Class ID",-1),Ze=V("label",null,"Detail",-1),ea=V("label",null,"Status",-1),aa=V("label",null,"Satisfaction",-1),la={class:"timeline-wrapper"},ta=V("div",{class:"timeline-header"},null,-1),sa={class:"timeline-wrapper-inner"},ia={class:"timeline-container pt-4"},ua={class:"load-more-wrap has-text-centered py-4"},oa=w(" Load More ");S();var da=_({setup(e){const{type:i,validate:u,editReportCall:o,saveReportCall:y,fetchReportCallType:b}=z(),{getStudentReportCalls:I}=te(),{createSurvey:S}=function(){const e=n();return r(),{createSurvey:async a=>await e.post("/Surveys/Students",{reportCallId:a.reportCallId,userEvaluatedId:a.userEvaluatedId})}}(),{user:_}=c(),{y:T}=R(),w=B(),J=q(),Q=L({topic:"SS",datetime:P().format(),type:"",classType:"",classId:null,detail:"",status:Z.SOLVED,satisfaction:ee.GOOD,studentId:parseInt(Array.isArray(J.params.id)?J.params.id[0]:J.params.id)}),W=L({reportCallId:0,userEvaluatedId:void 0,userEvaluatedName:void 0}),se=L(!1),ie=L([]),ue=L(!1),oe=L(!1),de=L(!1),ne=L(!1),re=[Z.SOLVED,Z.UNSOLVED],ce=[ee.GOOD,ee.EVERAGE,ee.POOR],pe=["PRIVATE_CLASS","GROUP_CLASS"].map((e=>({key:ae[e],value:le[e]}))),ve=h((()=>T.value>10)),me=h((()=>Object.values([Q.value.topic,Q.value.type]).every((e=>e)))),fe=h((()=>!(Q.value.topic&&Q.value.datetime&&Q.value.type&&Q.value.status&&Q.value.studentId))),ye=h((()=>!W.value.userEvaluatedId)),be=h((()=>2==(null==_?void 0:_.roleId))),he=()=>{var e;w.push({name:J.name||void 0,query:{page:(parseInt(`${null==(e=J.query)?void 0:e.page}`)||0)+1}})},Ie=async()=>{if(me.value){const e=((e,i)=>{for(var u in i||(i={}))l.call(i,u)&&s(e,u,i[u]);if(a)for(var u of a(i))t.call(i,u)&&s(e,u,i[u]);return e})({},Q.value);e.classId||(e.classId=null),e.detail||delete e.detail,e.classType||(e.classType=null),(null==e?void 0:e.id)?await o(e):await y(e),await _e(),Se()}},Se=()=>{Q.value={topic:"SS",datetime:P().format(),type:"",classType:"",classId:null,detail:"",status:Z.SOLVED,satisfaction:ee.GOOD,studentId:parseInt(Array.isArray(J.params.id)?J.params.id[0]:J.params.id)}},_e=async()=>{var e;const a=parseInt(`${null==(e=J.query)?void 0:e.page}`)||1;w.push({name:J.name||void 0,query:{page:a}});const l=await I({studentId:parseInt(`${J.params.id}`),currentPage:a,perPage:25});se.value=!l.nextPage,ie.value=l.data},ge=e=>{ue.value=!0,ke(e)},Ee=e=>{Ae(),W.value.reportCallId=e.id,be.value?(oe.value=!0,W.value.userEvaluatedId=e.createdBy.id,W.value.userEvaluatedName=e.createdBy.name):(de.value=!0,W.value.userEvaluatedId=void 0)},Ve=()=>{oe.value=!1},Te=()=>{ue.value=!1,Q.value.topic="SS",Q.value.datetime=P().format(),Q.value.type="",Q.value.classType="",Q.value.classId=null,Q.value.detail="",Q.value.status=Z.SOLVED,Q.value.satisfaction=ee.GOOD,Q.value.studentId=parseInt(Array.isArray(J.params.id)?J.params.id[0]:J.params.id)},ke=e=>{Q.value.id=null==e?void 0:e.id,Q.value.topic=null==e?void 0:e.topic,Q.value.datetime=P(null==e?void 0:e.datetime).format(),Q.value.type=null==e?void 0:e.type,Q.value.classType=null==e?void 0:e.classType,Q.value.classId=null==e?void 0:e.classId,Q.value.detail=null==e?void 0:e.detail,Q.value.status=null==e?void 0:e.status,Q.value.satisfaction=null==e?void 0:e.satisfaction,Q.value.studentId=parseInt(Array.isArray(J.params.id)?J.params.id[0]:J.params.id)},Ae=()=>{W.value.reportCallId=0,W.value.userEvaluatedId=void 0,W.value.userEvaluatedName=void 0},Oe=(e,a)=>{W.value.userEvaluatedId=e,W.value.userEvaluatedName=a},we=()=>{de.value=!0,Ve()},da=()=>{de.value=!1,Ae()};return M((async()=>{await _e(),Array.isArray(i.value)&&0===i.value.length&&await b()})),(e,a)=>{const l=d,t=v,s=m,o=Y("v-date-picker"),n=Y("Multiselect"),r=f,c=Ce,y=d,b=K,h=De,I=X;return g(),E("div",je,[V("div",xe,[V("div",{class:A(["form-head stuck-header",[k(ve)&&"is-stuck"]])},[V("div",Ue,[Me,V("div",Ye,[V("div",Re,[O(l,{color:"primary",disabled:!k(me),raised:"",onClick:Ie},{default:j((()=>[Be])),_:1},8,["disabled"])])])])],2),V("div",qe,[V("form",Le,[O(s,null,{default:j((()=>[Pe,O(t,{icon:"feather:archive"},{default:j((()=>[N(V("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>Q.value.topic=e),type:"text",class:A(["input",[Q.value.topic?"is-primary-focus":"is-danger-focus"]]),placeholder:"Topic"},null,2),[[H,Q.value.topic]]),N(V("label",Ne," Topic is required. ",512),[[G,!Q.value.topic]])])),_:1})])),_:1}),O(o,{modelValue:Q.value.datetime,"onUpdate:modelValue":a[1]||(a[1]=e=>Q.value.datetime=e),"model-config":{type:"string",mask:"YYYY-MM-DD HH:mm"},masks:{inputDateTime24hr:"DD/MM/YYYY HH:mm"},mode:"dateTime",is24hr:"",color:"orange","trim-weeks":"",popover:{visibility:"click"}},{default:j((({inputValue:e,inputEvents:a})=>[O(s,null,{default:j((()=>[He,O(t,{icon:"feather:calendar"},{default:j((()=>[V("input",$({class:"input",type:"text",value:e},F(a)),null,16,Ge)])),_:2},1024)])),_:2},1024)])),_:1},8,["modelValue"]),V("div",$e,[V("div",Fe,[O(s,null,{default:j((()=>[ze,O(t,null,{default:j((()=>[O(n,{modelValue:Q.value.type,"onUpdate:modelValue":a[2]||(a[2]=e=>Q.value.type=e),options:k(i),label:"key","value-prop":"value",placeholder:"Select type","can-clear":!1},null,8,["modelValue","options"]),N(V("label",Ke," Type is required. ",512),[[G,k(u).type]])])),_:1})])),_:1})]),V("div",Je,[O(s,null,{default:j((()=>[Qe,O(t,null,{default:j((()=>[O(n,{modelValue:Q.value.classType,"onUpdate:modelValue":a[3]||(a[3]=e=>Q.value.classType=e),options:k(pe),label:"key","value-prop":"value",placeholder:"Select class type"},null,8,["modelValue","options"]),We])),_:1})])),_:1})])]),O(s,null,{default:j((()=>[Xe,O(t,{icon:"feather:book-open"},{default:j((()=>[N(V("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value.classId=e),type:"number",class:"input is-primary-focus",placeholder:"Class ID"},null,512),[[H,Q.value.classId]])])),_:1})])),_:1}),O(s,null,{default:j((()=>[Ze,O(t,null,{default:j((()=>[N(V("textarea",{"onUpdate:modelValue":a[5]||(a[5]=e=>Q.value.detail=e),type:"textarea",class:"textarea is-primary-focus",rows:"4",placeholder:"Detail"},null,512),[[H,Q.value.detail]])])),_:1})])),_:1}),O(s,null,{default:j((()=>[ea,O(t,null,{default:j((()=>[(g(),E(U,null,C(re,(e=>O(r,{key:e,modelValue:Q.value.status,"onUpdate:modelValue":a[6]||(a[6]=e=>Q.value.status=e),value:e,label:e.charAt(0).toUpperCase()+e.slice(1),name:e,color:"primary"},null,8,["modelValue","value","label","name"]))),64))])),_:1})])),_:1}),O(s,null,{default:j((()=>[aa,O(t,null,{default:j((()=>[(g(),E(U,null,C(ce,(e=>O(r,{key:e,modelValue:Q.value.satisfaction,"onUpdate:modelValue":a[7]||(a[7]=e=>Q.value.satisfaction=e),class:"satisfaction",value:e,label:e.charAt(0).toUpperCase()+e.slice(1),name:e,square:!0},null,8,["modelValue","value","label","name"]))),64))])),_:1})])),_:1})])])]),V("div",la,[ta,V("div",sa,[V("div",ia,[O(c,{items:ie.value,"type-option":k(i),"class-type":k(pe),onSelectReportCall:ge,onSelectSatisfactionSurvey:Ee},null,8,["items","type-option","class-type"])]),V("div",ua,[se.value?x("",!0):(g(),D(y,{key:0,onClick:he},{default:j((()=>[oa])),_:1}))])])]),O(b,{"open-modal":ue.value,"report-call-info":Q.value,"disabled-save":k(fe),readonly:!1,"is-edit":!0,onToggleClose:Te,onOnCreate:a[8]||(a[8]=e=>(Ie(),Te()))},null,8,["open-modal","report-call-info","disabled-save"]),O(h,{"open-modal":oe.value,"user-evaluated-id":W.value.userEvaluatedId,"disabled-save":k(ye),readonly:!1,"is-edit":!0,onToggleClose:Ve,onOnSelect:Oe,onOnSave:we},null,8,["open-modal","user-evaluated-id","disabled-save"]),O(I,{open:de.value,title:"Sent Student Survey",subtitle:be.value&&W.value.userEvaluatedId?`Evaluated admin (${W.value.userEvaluatedId}) ${W.value.userEvaluatedName}`:void 0,"is-loading":ne.value,onClose:da,onConfirm:a[9]||(a[9]=e=>(async()=>{ne.value=!0;const e=await S(W.value);p(e,"Sent Student Survey!"),ne.value=!1,da(),Ae()})())},null,8,["open","subtitle","is-loading"])])}}});da.__scopeId="data-v-9f4dade2";export default da;
